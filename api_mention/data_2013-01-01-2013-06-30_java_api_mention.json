{"items": [{"body": "<p>The following print statement would print \"hello world\".\nCould anyone explain this?</p>\n\n<pre><code>System.out.println(randomString(-229985452) + \" \" + randomString(-147909649));\n</code></pre>\n\n<p>And <code>randomString()</code> looks like this:</p>\n\n<pre><code>public static String randomString(int i)\n{\n    Random ran = new Random(i);\n    StringBuilder sb = new StringBuilder();\n    while (true)\n    {\n        int k = ran.nextInt(27);\n        if (k == 0)\n            break;\n\n        sb.append((char)('`' + k));\n    }\n\n    return sb.toString();\n}\n</code></pre>\n", "title": "Why does this code using random strings print &quot;hello world&quot;?", "tags": ["java", "string", "random"], "link": "http://stackoverflow.com/questions/15182496/why-does-this-code-using-random-strings-print-hello-world", "post_type": "question", "question_id": 15182496}, {"body": "<p>I am working on some Java code which needs to be highly optimized as it will run in hot functions that are invoked at many points in my main program logic. Part of this code involves multiplying <code>double</code> variables by <code>10</code> raised to arbitrary non-negative <code>int</code> <code>exponent</code>s. One fast way (edit: but not the fastest possible, see Update 2 below) to get the multiplied value is to <code>switch</code> on the <code>exponent</code>:</p>\n\n<pre><code>double multiplyByPowerOfTen(final double d, final int exponent) {\n   switch (exponent) {\n      case 0:\n         return d;\n      case 1:\n         return d*10;\n      case 2:\n         return d*100;\n      // ... same pattern\n      case 9:\n         return d*1000000000;\n      case 10:\n         return d*10000000000L;\n      // ... same pattern with long literals\n      case 18:\n         return d*1000000000000000000L;\n      default:\n         throw new ParseException(\"Unhandled power of ten \" + power, 0);\n   }\n}\n</code></pre>\n\n<p>The commented ellipses above indicate that the <code>case</code> <code>int</code> constants continue incrementing by 1, so there are really 19 <code>case</code>s in the above code snippet. Since I wasn't sure whether I would actually need all the powers of 10 in <code>case</code> statements <code>10</code> thru <code>18</code>, I ran some microbenchmarks comparing the time to complete 10 million operations with this <code>switch</code> statement versus a <code>switch</code> with only <code>case</code>s <code>0</code> thru <code>9</code> (with the <code>exponent</code> limited to 9 or less to avoid breaking the pared-down <code>switch</code>). I got the rather surprising (to me, at least!) result that the longer <code>switch</code> with more <code>case</code> statements actually ran faster.</p>\n\n<p>On a lark, I tried adding even more <code>case</code>s which just returned dummy values, and found that  I could get the switch to run even faster with around 22-27 declared <code>case</code>s (even though those dummy cases are never actually hit while the code is running). (Again, <code>case</code>s were added in a contiguous fashion by incrementing the prior <code>case</code> constant by <code>1</code>.) These execution time differences are not very significant: for a random <code>exponent</code> between <code>0</code> and <code>10</code>, the dummy padded <code>switch</code> statement finishes 10 million executions in 1.49 secs versus 1.54 secs for the unpadded version, for a grand total savings of 5ns per execution. So, not the kind of thing that makes obsessing over padding out a <code>switch</code> statement worth the effort from an optimization standpoint. But I still just find it curious and counter-intuitive that a <code>switch</code> doesn't become slower (or perhaps at best maintain constant <em>O(1)</em> time) to execute as more <code>case</code>s are added to it.  </p>\n\n<p><img src=\"http://i.stack.imgur.com/kbnan.png\" alt=\"switch benchmarking results\"></p>\n\n<p>These are the results I obtained from running with various limits on the randomly-generated <code>exponent</code> values. I didn't include the results all the way down to <code>1</code> for the <code>exponent</code> limit, but the general shape of the curve remains the same, with a ridge around the 12-17 case mark, and a valley between 18-28. All tests were run in JUnitBenchmarks using shared containers for the random values to ensure identical testing inputs. I also ran the tests both in order from longest <code>switch</code> statement to shortest, and vice-versa, to try and eliminate the possibility of ordering-related test problems.  I've put my testing code up on a github repo if anyone wants to try to reproduce these results.</p>\n\n<p>So, what's going on here? Some vagaries of my architecture or micro-benchmark construction? Or is the Java <code>switch</code> really a little faster to execute in the <code>18</code> to <code>28</code> <code>case</code> range than it is from <code>11</code> up to <code>17</code>?</p>\n\n<p><a href=\"https://github.com/abissell/switch-experiment\">github test repo \"switch-experiment\"</a></p>\n\n<p><strong>UPDATE:</strong> I cleaned up the benchmarking library quite a bit and added a text file in /results with some output across a wider range of possible <code>exponent</code> values. I also added an option in the testing code not to throw an <code>Exception</code> from <code>default</code>, but this doesn't appear to affect the results.</p>\n\n<p><strong>UPDATE 2:</strong> Found some pretty good discussion of this issue from back in 2009 on the xkcd forum here: <a href=\"http://forums.xkcd.com/viewtopic.php?f=11&amp;t=33524\">http://forums.xkcd.com/viewtopic.php?f=11&amp;t=33524</a>. The OP's discussion of using <code>Array.binarySearch()</code> gave me the idea for a simple array-based implementation of the exponentiation pattern above. There's no need for the binary search since I know what the entries in the <code>array</code> are. It appears to run about 3 times faster than using <code>switch</code>, obviously at the expense of some of the control flow that <code>switch</code> affords. That code has been added to the github repo also.</p>\n", "title": "Why does Java switch on contiguous ints appear to run faster with added cases?", "tags": ["java", "performance", "assembly", "compiler-construction", "switch-statement"], "link": "http://stackoverflow.com/questions/15621083/why-does-java-switch-on-contiguous-ints-appear-to-run-faster-with-added-cases", "post_type": "question", "question_id": 15621083}, {"body": "<p>Which of the following is better practice in Java 8?</p>\n\n<p>Java 8:</p>\n\n<pre><code>joins.forEach(join -&gt; mIrc.join(mSession, join));\n</code></pre>\n\n<p>Java 7:</p>\n\n<pre><code>for (String join : joins) {\n    mIrc.join(mSession, join);\n}\n</code></pre>\n\n<p>I have lots of for loops that could be \"simplified\" with lambdas, but is there really any advantage of using them including performance and readability?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I'll also extend this question to longer methods - I know that you cant return or break the parent function from a lambda and this should be mentioned to if they are compared, but is there anything else to be considered?</p>\n", "title": "Java 8 Iterable.forEach() vs foreach loop", "tags": ["java", "for-loop", "java-8"], "link": "http://stackoverflow.com/questions/16635398/java-8-iterable-foreach-vs-foreach-loop", "post_type": "question", "question_id": 16635398}, {"body": "<p>I am trying to use the <code>org.springframework.orm.jdo.TransactionAwarePersistenceManagerFactoryProxy</code> in my Spring project, but I am not sure how to use it or whether it's exactly what I am looking for. I realize it can help make my DAOs work with a plain JDO <code>PersistenceManagerFactory</code>. Another question is: what happens if the proxy doesn't get made properly? Can I still use it to access my factory to create a transaction aware persistence manager? If the object managed by the factory is a singleton, does this change things? Why not just access the PersistenceManagerFactory directly? Perhaps <code>PersistenceManagerFactoryUtils.getPersistenceManager</code> would be more suited to my needs? Can <code>getObject</code> return null?</p>\n", "title": "Unsure if I understand TransactionAwarePersistenceManagerFactoryProxy", "tags": ["java", "spring", "persistence", "dao", "jdo"], "link": "http://stackoverflow.com/questions/14636178/unsure-if-i-understand-transactionawarepersistencemanagerfactoryproxy", "post_type": "question", "question_id": 14636178}, {"body": "<p>I made a class called <code>QuickRandom</code>, and its job is to produce random numbers quickly. It's really simple: just take the old value, multiply by a <code>double</code>, and take the decimal part.</p>\n\n<p>Here is my <code>QuickRandom</code> class in its entirety:</p>\n\n<pre><code>public class QuickRandom {\n    private double prevNum;\n    private double magicNumber;\n\n    public QuickRandom(double seed1, double seed2) {\n        if (seed1 &gt;= 1 || seed1 &lt; 0) throw new IllegalArgumentException(\"Seed 1 must be &gt;= 0 and &lt; 1, not \" + seed1);\n        prevNum = seed1;\n        if (seed2 &lt;= 1 || seed2 &gt; 10) throw new IllegalArgumentException(\"Seed 2 must be &gt; 1 and &lt;= 10, not \" + seed2);\n        magicNumber = seed2;\n    }\n\n    public QuickRandom() {\n        this(Math.random(), Math.random() * 10);\n    }\n\n    public double random() {\n        return prevNum = (prevNum*magicNumber)%1;\n    }\n\n}\n</code></pre>\n\n<p>And here is the code I wrote to test it:</p>\n\n<pre><code>public static void main(String[] args) {\n        QuickRandom qr = new QuickRandom();\n\n        /*for (int i = 0; i &lt; 20; i ++) {\n            System.out.println(qr.random());\n        }*/\n\n        //Warm up\n        for (int i = 0; i &lt; 10000000; i ++) {\n            Math.random();\n            qr.random();\n            System.nanoTime();\n        }\n\n        long oldTime;\n\n        oldTime = System.nanoTime();\n        for (int i = 0; i &lt; 100000000; i ++) {\n            Math.random();\n        }\n        System.out.println(System.nanoTime() - oldTime);\n\n        oldTime = System.nanoTime();\n        for (int i = 0; i &lt; 100000000; i ++) {\n            qr.random();\n        }\n        System.out.println(System.nanoTime() - oldTime);\n}\n</code></pre>\n\n<p>It is a very simple algorithm that simply multiplies the previous double by a \"magic number\" double. I threw it together pretty quickly, so I could probably make it better, but strangely, it seems to be working fine.</p>\n\n<p>This is sample output of the commented-out lines in the <code>main</code> method:</p>\n\n<pre><code>0.612201846732229\n0.5823974655091941\n0.31062451498865684\n0.8324473610354004\n0.5907187526770246\n0.38650264675748947\n0.5243464344127049\n0.7812828761272188\n0.12417247811074805\n0.1322738256858378\n0.20614642573072284\n0.8797579436677381\n0.022122999476108518\n0.2017298328387873\n0.8394849894162446\n0.6548917685640614\n0.971667953190428\n0.8602096647696964\n0.8438709031160894\n0.694884972852229\n</code></pre>\n\n<p>Hm. Pretty random. In fact, that would work for a random number generator in a game.</p>\n\n<p>Here is sample output of the non-commented out part:</p>\n\n<pre><code>5456313909\n1427223941\n</code></pre>\n\n<p>Wow! It performs almost 4 times faster than <code>Math.random</code>.</p>\n\n<p>I remember reading somewhere that <code>Math.random</code> used <code>System.nanoTime()</code> and tons of crazy modulus and division stuff. Is that really necessary? My algorithm performs a lot faster and it seems pretty random.</p>\n\n<p>I have two questions:</p>\n\n<ul>\n<li>Is my algorithm \"good enough\" (for, say, a game, where <strong>really</strong> random numbers aren't too important)?</li>\n<li>Why does <code>Math.random</code> do so much when it seems just simple multiplication and cutting out the decimal will suffice?</li>\n</ul>\n", "title": "Is this a &quot;good enough&quot; random algorithm; why isn&#39;t it used if it&#39;s faster?", "tags": ["java", "performance", "algorithm", "random"], "link": "http://stackoverflow.com/questions/14491966/is-this-a-good-enough-random-algorithm-why-isnt-it-used-if-its-faster", "post_type": "question", "question_id": 14491966}, {"body": "<p>I have a method with a <code>void</code> return type. It can also throw a number of exceptions so I'd like to test those exceptions being thrown. All attempts have failed with the same reason:</p>\n\n<blockquote>\n  <p>The method when(T) in the type Stubber is not applicable for the arguments (void)</p>\n</blockquote>\n\n<p>Any ideas how I can get the method to throw a specified exception?</p>\n\n<pre><code>doThrow(new Exception()).when(mockedObject.methodReturningVoid(...));\n</code></pre>\n", "title": "Mockito test a void method throws an exception", "tags": ["java", "exception", "mocking", "mockito"], "link": "http://stackoverflow.com/questions/15156857/mockito-test-a-void-method-throws-an-exception", "post_type": "question", "question_id": 15156857}, {"body": "<p>I'm using Spring MVC for a simple JSON API, with <code>@ResponseBody</code> based approach like the following. (I already have a service layer producing JSON directly.)</p>\n\n<pre><code>@RequestMapping(value = \"/matches/{matchId}\", produces = \"application/json\")\n@ResponseBody\npublic String match(@PathVariable String matchId) {\n    String json = matchService.getMatchJson(matchId);\n    if (json == null) {\n        // TODO: how to respond with e.g. 400 \"bad request\"?\n    }\n    return json;\n}\n</code></pre>\n\n<p>Question is, in the given scenario, <strong>what is the simplest, cleanest way to respond with a HTTP 400 error</strong>?</p>\n\n<p>I did come across approaches like:</p>\n\n<pre><code>return new ResponseEntity(HttpStatus.BAD_REQUEST);\n</code></pre>\n\n<p>...but I can't use it here since my method's return type is String, not ResponseEntity.</p>\n", "title": "How to respond with HTTP 400 error in a Spring MVC @ResponseBody method returning String?", "tags": ["java", "spring", "spring-mvc", "http-error"], "link": "http://stackoverflow.com/questions/16232833/how-to-respond-with-http-400-error-in-a-spring-mvc-responsebody-method-returnin", "post_type": "question", "question_id": 16232833}, {"body": "<p>The usual constructor of <code>ArrayList</code> is:</p>\n\n<pre><code>ArrayList&lt;?&gt; list = new ArrayList&lt;&gt;();\n</code></pre>\n\n<p>But there is also an overloaded constructor with a parameter for its initial capacity:</p>\n\n<pre><code>ArrayList&lt;?&gt; list = new ArrayList&lt;&gt;(20);\n</code></pre>\n\n<p>Why is it useful to create an <code>ArrayList</code> with an initial capacity when we can append to it as we please?</p>\n", "title": "Why start an ArrayList with an initial capacity?", "tags": ["java", "data-structures", "arraylist", "capacity"], "link": "http://stackoverflow.com/questions/15430247/why-start-an-arraylist-with-an-initial-capacity", "post_type": "question", "question_id": 15430247}, {"body": "<p>What are some of the situations where I can use <code>Collections.emptyMap()</code> ? The Documentation says I can use this method if I want my collection to be immutable. </p>\n\n<p><strong>Why would I want an immutable empty collection? What is the point?</strong></p>\n", "title": "Collections.emptyMap() vs new HashMap()", "tags": ["java", "collections"], "link": "http://stackoverflow.com/questions/14846920/collections-emptymap-vs-new-hashmap", "post_type": "question", "question_id": 14846920}, {"body": "<p>I have a <a href=\"http://docs.oracle.com/javase/8/docs/api/java/lang/StringBuilder.html\"><code>StringBuilder</code></a> object,</p>\n\n<pre><code>StringBuilder result = new StringBuilder();\nresult.append(someChar);\n</code></pre>\n\n<p>Now I want to append a newline character to the <code>StringBuilder</code>. How can I do it?</p>\n\n<pre><code>result.append(\"/n\"); \n</code></pre>\n\n<p>Does not work. So, I was thinking about writing a newline using Unicode. Will this help? If so, how can I add one?</p>\n", "title": "How to append a newline to StringBuilder", "tags": ["java", "stringbuilder"], "link": "http://stackoverflow.com/questions/14534767/how-to-append-a-newline-to-stringbuilder", "post_type": "question", "question_id": 14534767}, {"body": "<p>All I'm trying to do is download some JSON and deserialize it into an object. I haven't got as far as downloading the JSON yet.</p>\n\n<p>Almost every single HttpClient example I can find, including those on the apache site looks something like...</p>\n\n<pre><code>import org.apache.http.client.HttpClient;\nimport org.apache.http.impl.client.DefaultHttpClient;\n\npublic void blah() {\n    HttpClient client = new DefaultHttpClient();\n    ...\n}\n</code></pre>\n\n<p>However, Netbeans tells me that <code>DefaultHttpClient</code> is deprecated. I've tried googling for <code>DefaultHttpClient deprecated</code> and as many other variations as I can think of and can't find any useful results, so I'm obviously missing something.</p>\n\n<p>What is the correct Java7 way to download the contents of a webpage? Is there really no decent Http Client as part of the language? I find that hard to believe.</p>\n\n<p>My Maven dependency for this is...</p>\n\n<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;\n    &lt;artifactId&gt;httpclient&lt;/artifactId&gt;\n    &lt;version&gt;LATEST&lt;/version&gt;\n    &lt;type&gt;jar&lt;/type&gt;\n&lt;/dependency&gt;\n</code></pre>\n", "title": "Deprecated Java HttpClient - How hard can it be?", "tags": ["java", "migration", "apache-httpclient-4.x", "apache-commons-httpclient"], "link": "http://stackoverflow.com/questions/15336477/deprecated-java-httpclient-how-hard-can-it-be", "post_type": "question", "question_id": 15336477}, {"body": "<p>Why do Double.parseDouble(null) and Integer.parseInt(null) throw different exceptions?</p>\n\n<p>Is this a historical accident or intentional? The documentation clearly states two types of exceptions for <a href=\"http://docs.oracle.com/javase/7/docs/api/java/lang/Double.html#parseDouble%28java.lang.String%29\"><code>Double.parseDouble(...)</code></a> and one for <a href=\"http://docs.oracle.com/javase/7/docs/api/java/lang/Integer.html#parseInt%28java.lang.String%29\"><code>Integer.parseInt()</code></a>, but it seems inconsistent:</p>\n\n<pre><code>Integer.parseInt(null); // throws java.lang.NumberFormatException: null\n</code></pre>\n\n<p>However </p>\n\n<pre><code>Double.parseDouble(null); // throws java.lang.NullPointerException\n</code></pre>\n", "title": "Why do Double.parseDouble(null) and Integer.parseInt(null) throw different exceptions?", "tags": ["java", "exception", "nullpointerexception", "numberformatexception"], "link": "http://stackoverflow.com/questions/16324831/why-do-double-parsedoublenull-and-integer-parseintnull-throw-different-excep", "post_type": "question", "question_id": 16324831}, {"body": "<p>I'm relative new to the webservices world and my research seems to have confused me more than enlighten me, my problem is that I was given a library(jar) which I have to extend with some webservice functionality.</p>\n\n<p>This library will be shared to other developers, and among the classes in the jar will be classes that have a method which calls a webservice (that essentially sets an attribute of the class, does some business logic, like storing the object in a db, etc and sends back the object with those modifications). I want to make the call to this service as simple as possible, hopefully as simple so that the developer using the class only need to do.</p>\n\n<pre><code>Car c = new Car(\"Blue\");\nc.webmethod();\n</code></pre>\n\n<p>I have been studying JAX-WS to use on the server but seems to me that I don't need to create a <code>wsimport</code> in the server nor the <code>wsimport</code> on the client, since I know that both have the classes, I just need some interaction between classes shared in both the server and the client. How do you think makes sense to do the webservice and the call in the class?</p>\n", "title": "How to do a SOAP Web Service call from Java class?", "tags": ["java", "web-services", "soap", "jax-ws", "saaj"], "link": "http://stackoverflow.com/questions/15940234/how-to-do-a-soap-web-service-call-from-java-class", "post_type": "question", "question_id": 15940234}, {"body": "<p>I am trying to build a HashMap which will have integer as keys and objects as values.</p>\n\n<p>My syntax is:</p>\n\n<pre><code>HashMap&lt;int, myObject&gt; myMap = new HashMap&lt;int, myObject&gt;();\n</code></pre>\n\n<p>However, the error returned is - Syntax error on token \"int\", Dimensions expected after this token - I don't understand why I should add a dimension (ie: making the int into an array) since I only need to store a digit as key.</p>\n\n<p>What could I do?</p>\n\n<p>Thanks in advance! :)</p>\n", "title": "HashMap and int as key", "tags": ["java", "hashmap"], "link": "http://stackoverflow.com/questions/16148575/hashmap-and-int-as-key", "post_type": "question", "question_id": 16148575}, {"body": "<p>The other answers explain why, but here is how:</p>\n\n<pre><code>new Random(-229985452).nextInt(27)\n</code></pre>\n\n<p>The first 6 numbers that the above random generates are:</p>\n\n<pre><code>8\n5\n12\n12\n15\n0\n</code></pre>\n\n<p>and the first 6 numbers that <code>new Random(-147909649).nextInt(27)</code> generates are:</p>\n\n<pre><code>23\n15\n18\n12\n4\n0\n</code></pre>\n\n<p>Then just add those numbers to the integer representation of the character <code>`</code> (which is 96):</p>\n\n<pre><code>8  + 96 = 104 --&gt; h\n5  + 96 = 101 --&gt; e\n12 + 96 = 108 --&gt; l\n12 + 96 = 108 --&gt; l\n15 + 96 = 111 --&gt; o\n\n23 + 96 = 119 --&gt; w\n15 + 96 = 111 --&gt; o\n18 + 96 = 114 --&gt; r\n12 + 96 = 108 --&gt; l\n4  + 96 = 100 --&gt; d\n</code></pre>\n", "title": "Why does this code using random strings print &quot;hello world&quot;?", "tags": ["java", "string", "random"], "link": "http://stackoverflow.com/questions/15182496/why-does-this-code-using-random-strings-print-hello-world/15182578#15182578", "post_type": "answer", "question_id": 15182496, "answer_id": 15182578}, {"body": "<p>If you're unsure about something, try writing a test first.</p>\n\n<p>I did this:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>//primitive\nSystem.out.println(int.class.getName());\nSystem.out.println(int.class.getCanonicalName());\nSystem.out.println(int.class.getSimpleName());\n\nSystem.out.println();\n\n//class\nSystem.out.println(String.class.getName());\nSystem.out.println(String.class.getCanonicalName());\nSystem.out.println(String.class.getSimpleName());\n\nSystem.out.println();\n\n//inner class\nSystem.out.println(HashMap.SimpleEntry.class.getName());\nSystem.out.println(HashMap.SimpleEntry.class.getCanonicalName());\nSystem.out.println(HashMap.SimpleEntry.class.getSimpleName());        \n\nSystem.out.println();\n\n//anonymous inner class\nSystem.out.println(new Serializable(){}.getClass().getName());\nSystem.out.println(new Serializable(){}.getClass().getCanonicalName());\nSystem.out.println(new Serializable(){}.getClass().getSimpleName());\n</code></pre>\n\n<p>Prints:</p>\n\n<pre>\nint\nint\nint\n\njava.lang.String\njava.lang.String\nString\n\njava.util.AbstractMap$SimpleEntry\njava.util.AbstractMap.SimpleEntry\nSimpleEntry\n\nClassnameTest$1\nnull\n\n</pre>\n\n<p>There's an empty line in the last block where <code>getSimpleName</code> returns an empty string.</p>\n\n<p>The upshot looking at this is:</p>\n\n<ul>\n<li>the <strong>name</strong> is the name that you'd use to dynamically load the class with, for example, a call to <code>Class.forName</code> with the default <code>ClassLoader</code>.</li>\n<li>the <strong>canonical name</strong> is the name that would be used in an import statement and uniquely identifies the class.  Might be useful during <code>toString</code> or logging operations.</li>\n<li>the <strong>simple name</strong> loosely identifies the class, again might be useful during <code>toString</code> or logging operations but is not guaranteed to be unique.</li>\n</ul>\n", "title": "What is the difference between canonical name, simple name and class name in Java Class?", "tags": ["java"], "link": "http://stackoverflow.com/questions/15202997/what-is-the-difference-between-canonical-name-simple-name-and-class-name-in-jav/15203417#15203417", "post_type": "answer", "question_id": 15202997, "answer_id": 15203417}, {"body": "<p>Adding local classes, lambdas and the <code>toString()</code> method to complete the previous two answers. Further, I add arrays of lambdas and arrays of anonymous classes (which do not make any sense in practice though):</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>package com.example;\n\npublic final class TestClassNames {\n    private static void showClass(Class&lt;?&gt; c) {\n        System.out.println(\"getName(): \" + c.getName());\n        System.out.println(\"getCanonicalName(): \" + c.getCanonicalName());\n        System.out.println(\"getSimpleName(): \" + c.getSimpleName());\n        System.out.println(\"toString(): \" + c.toString());\n        System.out.println();\n    }\n\n    private static void x(Runnable r) {\n        showClass(r.getClass());\n        showClass(java.lang.reflect.Array.newInstance(r.getClass(), 1).getClass()); // Obtains an array class of a lambda base type.\n    }\n\n    public static class NestedClass {}\n\n    public class InnerClass {}\n\n    public static void main(String[] args) {\n        class LocalClass {}\n        showClass(void.class);\n        showClass(int.class);\n        showClass(String.class);\n        showClass(Runnable.class);\n        showClass(SomeEnum.class);\n        showClass(SomeAnnotation.class);\n        showClass(int[].class);\n        showClass(String[].class);\n        showClass(NestedClass.class);\n        showClass(InnerClass.class);\n        showClass(LocalClass.class);\n        showClass(LocalClass[].class);\n        Object anonymous = new java.io.Serializable() {};\n        showClass(anonymous.getClass());\n        showClass(java.lang.reflect.Array.newInstance(anonymous.getClass(), 1).getClass()); // Obtains an array class of an anonymous base type.\n        x(() -&gt; {});\n    }\n}\n\nenum SomeEnum {\n   BLUE, YELLOW, RED;\n}\n\n@interface SomeAnnotation {}\n</code></pre>\n\n<p>This is the full output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>getName(): void\ngetCanonicalName(): void\ngetSimpleName(): void\ntoString(): void\n\ngetName(): int\ngetCanonicalName(): int\ngetSimpleName(): int\ntoString(): int\n\ngetName(): java.lang.String\ngetCanonicalName(): java.lang.String\ngetSimpleName(): String\ntoString(): class java.lang.String\n\ngetName(): java.lang.Runnable\ngetCanonicalName(): java.lang.Runnable\ngetSimpleName(): Runnable\ntoString(): interface java.lang.Runnable\n\ngetName(): com.example.SomeEnum\ngetCanonicalName(): com.example.SomeEnum\ngetSimpleName(): SomeEnum\ntoString(): class com.example.SomeEnum\n\ngetName(): com.example.SomeAnnotation\ngetCanonicalName(): com.example.SomeAnnotation\ngetSimpleName(): SomeAnnotation\ntoString(): interface com.example.SomeAnnotation\n\ngetName(): [I\ngetCanonicalName(): int[]\ngetSimpleName(): int[]\ntoString(): class [I\n\ngetName(): [Ljava.lang.String;\ngetCanonicalName(): java.lang.String[]\ngetSimpleName(): String[]\ntoString(): class [Ljava.lang.String;\n\ngetName(): com.example.TestClassNames$NestedClass\ngetCanonicalName(): com.example.TestClassNames.NestedClass\ngetSimpleName(): NestedClass\ntoString(): class com.example.TestClassNames$NestedClass\n\ngetName(): com.example.TestClassNames$InnerClass\ngetCanonicalName(): com.example.TestClassNames.InnerClass\ngetSimpleName(): InnerClass\ntoString(): class com.example.TestClassNames$InnerClass\n\ngetName(): com.example.TestClassNames$1LocalClass\ngetCanonicalName(): null\ngetSimpleName(): LocalClass\ntoString(): class com.example.TestClassNames$1LocalClass\n\ngetName(): [Lcom.example.TestClassNames$1LocalClass;\ngetCanonicalName(): null\ngetSimpleName(): LocalClass[]\ntoString(): class [Lcom.example.TestClassNames$1LocalClass;\n\ngetName(): com.example.TestClassNames$1\ngetCanonicalName(): null\ngetSimpleName(): \ntoString(): class com.example.TestClassNames$1\n\ngetName(): [Lcom.example.TestClassNames$1;\ngetCanonicalName(): null\ngetSimpleName(): []\ntoString(): class [Lcom.example.TestClassNames$1;\n\ngetName(): com.example.TestClassNames$$Lambda$1/1175962212\ngetCanonicalName(): com.example.TestClassNames$$Lambda$1/1175962212\ngetSimpleName(): TestClassNames$$Lambda$1/1175962212\ntoString(): class com.example.TestClassNames$$Lambda$1/1175962212\n\ngetName(): [Lcom.example.TestClassNames$$Lambda$1;\ngetCanonicalName(): com.example.TestClassNames$$Lambda$1/1175962212[]\ngetSimpleName(): TestClassNames$$Lambda$1/1175962212[]\ntoString(): class [Lcom.example.TestClassNames$$Lambda$1;\n</code></pre>\n\n<p>So, here are the rules. First, lets start with primitive types and <code>void</code>:</p>\n\n<ol>\n<li>If the class object represents a primitive type or <code>void</code>, all the four methods simply returns its name.</li>\n</ol>\n\n<p>Now the rules for the <code>getName()</code> method:</p>\n\n<ol start=\"2\">\n<li>Every non-lambda and non-array class or interface (i.e, top-level, nested, inner, local and anonymous) has a name (which is returned by <code>getName()</code>) that is the package name followed by a dot (if there is a package), followed by the name of its class-file as generated by the compiler (whithout the suffix <code>.class</code>). If there is no package, it is simply the name of the class-file. If the class is an inner, nested, local or anonymous class, the compiler should generate at least one <code>$</code> in its class-file name. Note that for anonymous classes, the class name would end with a dollar-sign followed by a number.</li>\n<li>Lambda class names are generally unpredictable, and you shouldn't care about they anyway. Exactly, their name is the name of the enclosing class, followed by <code>$$Lambda$</code>, followed by a number, followed by a slash, followed by another number.</li>\n<li>The class descriptor of the primitives are <code>Z</code> for <code>boolean</code>, <code>B</code> for <code>byte</code>, <code>S</code> for <code>short</code>, <code>C</code> for <code>char</code>, <code>I</code> for <code>int</code>, <code>J</code> for <code>long</code>, <code>F</code> for <code>float</code> and <code>D</code> for <code>double</code>. For non-array classes and interfaces the class descriptor is <code>L</code> followed by what is given by <code>getName()</code> followed by <code>;</code>. For array classes, the class descriptor is <code>[</code> followed by the class descriptor of the component type (which may be itself another array class).</li>\n<li>For array classes, the <code>getName()</code> method returns its class descriptor. This rule seems to fail only for array classes whose the component type is a lambda (which possibly is a bug), but hopefully this should not matter anyway because there is no point even on the existence of array classes whose component type is a lambda.</li>\n</ol>\n\n<p>Now, the <code>toString()</code> method:</p>\n\n<ol start=\"6\">\n<li>If the class instance represents an interface (or an annotation, which is a special type of interface), the <code>toString()</code> returns <code>\"interface \" + getName()</code>. If it is a primitive, it returns simply <code>getName()</code>. If it is something else (a class type, even if it is a pretty weird one), it returns <code>\"class \" + getName()</code>.</li>\n</ol>\n\n<p>The <code>getCanonicalName()</code> method:</p>\n\n<ol start=\"7\">\n<li>For top-level classes and interfaces, the <code>getCanonicalName()</code> method returns just what the <code>getName()</code> method returns.</li>\n<li>The <code>getCanonicalName()</code> method returns <code>null</code> for anonymous or local classes and for array classes of those.</li>\n<li>For inner and nested classes and interfaces, the <code>getCanonicalName()</code> method returns what the <code>getName()</code> method would replacing the compiler-introduced dollar-signs by dots.</li>\n<li>For array classes, the <code>getCanonicalName()</code> method returns <code>null</code> if the canonical name of the component type is <code>null</code>. Otherwise, it returns the canonical name of the component type followed by <code>[]</code>.</li>\n</ol>\n\n<p>The <code>getSimpleName()</code> method:</p>\n\n<ol start=\"11\">\n<li>For top-level, nested, inner and local classes, the <code>getSimpleName()</code> returns the name of the class as written in the source file.</li>\n<li>For anonymous classes the <code>getSimpleName()</code> returns an empty <code>String</code>.</li>\n<li>For lambda classes the <code>getSimpleName()</code> just returns what the <code>getName()</code> would return without the package name. This do not makes much sense and looks like a bug for me, but there is no point in calling <code>getSimpleName()</code> on a lambda class to start with.</li>\n<li>For array classes the <code>getSimpleName()</code> method returns the simple name of the component class followed by <code>[]</code>. This have the funny/weird side-effect that array classes whose component type is an anonymous class have just <code>[]</code> as their simple names.</li>\n</ol>\n", "title": "What is the difference between canonical name, simple name and class name in Java Class?", "tags": ["java"], "link": "http://stackoverflow.com/questions/15202997/what-is-the-difference-between-canonical-name-simple-name-and-class-name-in-jav/29527145#29527145", "post_type": "answer", "question_id": 15202997, "answer_id": 29527145}, {"body": "<p>I've been confused by the wide range of different naming schemes as well, and was just about to ask and answer my own question on this when I found this question here. I think my findings fit it well enough, and complement what's already here. My focus is looking for <em>documentation</em> on the various terms, and adding some more related terms that might crop up in other places.</p>\n\n<p>Consider the following example:</p>\n\n<pre><code>package a.b;\nclass C {\n  static class D extends C {\n  }\n  D d;\n  D[] ds;\n}\n</code></pre>\n\n<ul>\n<li><p>The <strong>simple name</strong> of <code>D</code> is <code>D</code>. That's just the part you wrote when declaring the class. <a href=\"https://docs.oracle.com/javase/specs/jls/se8/html/jls-15.html#jls-15.9\" rel=\"nofollow\">Anonymous classes</a> have no simple name. <a href=\"http://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getSimpleName--\" rel=\"nofollow\"><code>Class.getSimpleName()</code></a> returns this name or the empty string. It is possible for the simple name to contain a <code>$</code> if you write it like this, since <code>$</code> is a valid part of an identifier.</p></li>\n<li><p>According to <a href=\"http://docs.oracle.com/javase/specs/jls/se8/html/jls-6.html#jls-6.7\" rel=\"nofollow\">the JLS section 6.7</a>, both <code>a.b.C.D</code> and <code>a.b.C.D.D.D</code> would be <strong>fully qualified names</strong>, but only <code>a.b.C.D</code> would be the <strong>canonical name</strong> of <code>D</code>. So every canonical name is a fully qualified name, but the converes is not always true. <a href=\"http://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getCanonicalName--\" rel=\"nofollow\"><code>Class.getCanonicalName()</code></a> will return the canonical name or <code>null</code>.</p></li>\n<li><p><a href=\"http://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getName--\" rel=\"nofollow\"><code>Class.getName()</code></a> is documented to return the <strong>binary name</strong>, as specified in <a href=\"https://docs.oracle.com/javase/specs/jls/se8/html/jls-13.html#jls-13.1\" rel=\"nofollow\">JLS section 13.1</a>. In this case it returns <code>a.b.C$D</code> for <code>D</code> and <code>[La.b.C$D;</code> for <code>D[]</code>.</p></li>\n<li><p><a href=\"http://stackoverflow.com/a/13343540/1468366\">This answer</a> demonstrates that it is possible for two classes loaded by the same class loader to have the same <strong>canonical name</strong> but distinct <strong>binary names</strong>. Neither name is sufficient to reliably deduce the other: if you have the canonical name, you don't know which parts of the name are packages and which are containing classes. If you have the binary name, you don't know which <code>$</code> were introduced as separators and which were part of some simple name.</p></li>\n<li><p><a href=\"https://docs.oracle.com/javase/specs/jls/se8/html/jls-15.html#jls-15.9\" rel=\"nofollow\">Anonymous classes</a> and <a href=\"https://docs.oracle.com/javase/specs/jls/se8/html/jls-14.html#jls-14.3\" rel=\"nofollow\">local classes</a> have no <strong>fully qualified names</strong> but still have a <strong>binary name</strong>. The same holds for classes nested inside such classes. <em>Every</em> class has a binary name.</p></li>\n<li><p>Running <code>javap -v -private</code> on <code>a/b/C.class</code> shows that the bytecode refers to the type of <code>d</code> as <code>La/b/C$D;</code> and that of the array <code>ds</code> as <code>[La/b/C$D;</code>. These are called <strong>descriptors</strong>, and they are specified in <a href=\"http://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.3\" rel=\"nofollow\">JVMS section 4.3</a>.</p></li>\n<li><p>The class name <code>a/b/C$D</code> used in both of these descriptors is what you get by replacing <code>.</code> by <code>/</code> in the binary name. The JVM spec apparently calls this the <strong>internal form of the binary name</strong>. <a href=\"http://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.2.1\" rel=\"nofollow\">JVMS section 4.2.1</a> describes it, and states that the difference from the binary name were for historical reasons.</p></li>\n<li><p>The <strong>file name</strong> of a class in one of the typical filename-based class loaders is what you get if you interpret the <code>/</code> in the internal form of the binary name as a directory separator, and append the file name extension <code>.class</code> to it. It's resolved relative to the class path used by the class loader in question.</p></li>\n</ul>\n", "title": "What is the difference between canonical name, simple name and class name in Java Class?", "tags": ["java"], "link": "http://stackoverflow.com/questions/15202997/what-is-the-difference-between-canonical-name-simple-name-and-class-name-in-jav/36978943#36978943", "post_type": "answer", "question_id": 15202997, "answer_id": 36978943}, {"body": "<p>this is best document I found describing getName(), getSimpleName(), getCanonicalName()</p>\n\n<p><a href=\"https://javahowtodoit.wordpress.com/2014/09/09/java-lang-class-what-is-the-difference-between-class-getname-class-getcanonicalname-and-class-getsimplename/\" rel=\"nofollow\">https://javahowtodoit.wordpress.com/2014/09/09/java-lang-class-what-is-the-difference-between-class-getname-class-getcanonicalname-and-class-getsimplename/</a></p>\n\n<pre><code>// Primitive type\nint.class.getName();          // -&gt; int\nint.class.getCanonicalName(); // -&gt; int\nint.class.getSimpleName();    // -&gt; int\n\n// Standard class\nInteger.class.getName();          // -&gt; java.lang.Integer\nInteger.class.getCanonicalName(); // -&gt; java.lang.Integer\nInteger.class.getSimpleName();    // -&gt; Integer\n\n// Inner class\nMap.Entry.class.getName();          // -&gt; java.util.Map$Entry\nMap.Entry.class.getCanonicalName(); // -&gt; java.util.Map.Entry\nMap.Entry.class.getSimpleName();    // -&gt; Entry     \n\n// Anonymous inner class\nClass&lt;?&gt; anonymousInnerClass = new Cloneable() {}.getClass();\nanonymousInnerClass.getName();          // -&gt; somepackage.SomeClass$1\nanonymousInnerClass.getCanonicalName(); // -&gt; null\nanonymousInnerClass.getSimpleName();    // -&gt; // An empty string\n\n// Array of primitives\nClass&lt;?&gt; primitiveArrayClass = new int[0].getClass();\nprimitiveArrayClass.getName();          // -&gt; [I\nprimitiveArrayClass.getCanonicalName(); // -&gt; int[]\nprimitiveArrayClass.getSimpleName();    // -&gt; int[]\n\n// Array of objects\nClass&lt;?&gt; objectArrayClass = new Integer[0].getClass();\nobjectArrayClass.getName();          // -&gt; [Ljava.lang.Integer;\nobjectArrayClass.getCanonicalName(); // -&gt; java.lang.Integer[]\nobjectArrayClass.getSimpleName();    // -&gt; Integer[]\n</code></pre>\n", "title": "What is the difference between canonical name, simple name and class name in Java Class?", "tags": ["java"], "link": "http://stackoverflow.com/questions/15202997/what-is-the-difference-between-canonical-name-simple-name-and-class-name-in-jav/37603567#37603567", "post_type": "answer", "question_id": 15202997, "answer_id": 37603567}, {"body": "<p>The advantage comes into account when the operations can be executed in parallel. (See <a href=\"http://java.dzone.com/articles/devoxx-2012-java-8-lambda-and\">http://java.dzone.com/articles/devoxx-2012-java-8-lambda-and</a> - the section about internal and external iteration)</p>\n\n<ul>\n<li><p>The main advantage from my point of view is that the implementation of what is to be done within the loop can be defined without having to decide if it will be executed in parallel or sequential</p></li>\n<li><p>If you want your loop to be executed in parallel you could simply write</p>\n\n<pre><code> joins.parallelStream().forEach((join) -&gt; mIrc.join(mSession, join));\n</code></pre>\n\n<p>You will have to write some extra code for thread handling etc.</p></li>\n</ul>\n\n<p><strong>Note :</strong>\nfor my answer I assumed joins implementing the <code>java.util.Stream</code> interface. If joins implements only the <code>java.util.Iterable</code> interface this is no longer true. </p>\n", "title": "Java 8 Iterable.forEach() vs foreach loop", "tags": ["java", "for-loop", "java-8"], "link": "http://stackoverflow.com/questions/16635398/java-8-iterable-foreach-vs-foreach-loop/16635489#16635489", "post_type": "answer", "question_id": 16635398, "answer_id": 16635489}, {"body": "<p>I feel that I need to extend my comment a bit...</p>\n\n<p><em>About paradigm\\style</em></p>\n\n<p>That's probably the most notable aspect. FP became popular due to what you can get avoiding side-effects. I won't delve deep into what pros\\cons you can get from this, since this is not related to the question.</p>\n\n<p>However, I will say that the iteration using Iterable.forEach is inspired by FP and rather result of bringing more FP to Java (ironically, I'd say that there is no much use for forEach in pure FP, since it does nothing except introducing side-effects).</p>\n\n<p>In the end I would say that it is rather a matter of taste\\style\\paradigm you are currently writing in.</p>\n\n<p><em>About parallelism.</em></p>\n\n<p>From performance point of view there is no promised notable benefits from using Iterable.forEach over foreach(...).</p>\n\n<p>According to official <a href=\"http://download.java.net/jdk8/docs/api/java/lang/Iterable.html#forEach%28java.util.function.Consumer%29\" rel=\"nofollow\">docs on Iterable.forEach</a> :</p>\n\n<blockquote>\n  <p>Performs the given action on the contents of the Iterable, <strong>in the\n  order elements occur</strong> when iterating, until all elements have been\n  processed or the action throws an exception.</p>\n</blockquote>\n\n<p>... i.e. docs pretty much clear that there will be no implicit parallelism. Adding one would be LSP violation.</p>\n\n<p>Now, there are \"parallell collections\" that are promised in Java 8, but to work with those you need to me more explicit and put some extra care to use them (see mschenk74's answer for example).</p>\n\n<p>BTW: in this case <a href=\"http://download.java.net/jdk8/docs/api/java/util/stream/Stream.html#forEach%28java.util.function.Consumer%29\" rel=\"nofollow\">Stream.forEach</a> will be used, and it doesn't guarantee that actual work will be done in parallell (depends on underlying collection).</p>\n\n<p><strong>UPDATE:</strong> might be not that obvious and a little stretched at a glance but there is another facet of style and readability perspective.</p>\n\n<p>First of all - plain old forloops are plain and old. Everybody already knows them.</p>\n\n<p>Second, and more important - you probably want to use Iterable.forEach only with one-liner lambdas. If \"body\" gets heavier - they tend to be not-that readable.\nYou have 2 options from here - use inner classes (yuck) or use plain old forloop.\nPeople often gets annoyed when they see the same things (iteratins over collections) being done various vays/styles in the same codebase, and this seems to be the case.</p>\n\n<p>Again, this might or might not be an issue. Depends on people working on code.</p>\n", "title": "Java 8 Iterable.forEach() vs foreach loop", "tags": ["java", "for-loop", "java-8"], "link": "http://stackoverflow.com/questions/16635398/java-8-iterable-foreach-vs-foreach-loop/16636899#16636899", "post_type": "answer", "question_id": 16635398, "answer_id": 16636899}, {"body": "<p><code>forEach()</code> can be implemented to be faster than for-each loop, because the iterable knows the best way to iterate its elements, as opposed to the standard iterator way. So the difference is loop internally or loop externally. </p>\n\n<p>For example <code>ArrayList.forEach(action)</code> may be simply implemented as </p>\n\n<pre><code>for(int i=0; i&lt;size; i++)\n    action.accept(elements[i])\n</code></pre>\n\n<p>as opposed to the for-each loop which requires a lot of scaffolding </p>\n\n<pre><code>Iterator iter = list.iterator();\nwhile(iter.hasNext())\n    Object next = iter.next();\n    do something with `next`\n</code></pre>\n\n<p>However, we also need to account for two overhead costs by using <code>forEach()</code>, one is making the lambda object, the other is invoking the lambda method. They are probably not significant.</p>\n\n<p>see also <a href=\"http://journal.stuffwithstuff.com/2013/01/13/iteration-inside-and-out/\" rel=\"nofollow\">http://journal.stuffwithstuff.com/2013/01/13/iteration-inside-and-out/</a> for comparing internal/external iterations for different use cases.</p>\n", "title": "Java 8 Iterable.forEach() vs foreach loop", "tags": ["java", "for-loop", "java-8"], "link": "http://stackoverflow.com/questions/16635398/java-8-iterable-foreach-vs-foreach-loop/16637740#16637740", "post_type": "answer", "question_id": 16635398, "answer_id": 16637740}, {"body": "<p>The better practice is to use <code>for-each</code>. Besides violating the <em>Keep It Simple, Stupid</em> principle, the new-fangled <code>forEach()</code> has at least the following deficiencies:</p>\n\n<ul>\n<li><p><strong>Can't use non-final variables</strong>. So, code like the following can't be turned into a forEach lambda:</p>\n\n<blockquote>\n<pre><code>Object prev = null;\nfor(Object curr : list)\n{\n    if( prev != null )\n        foo(prev, curr);\n    prev = curr;\n}\n</code></pre>\n</blockquote></li>\n<li><p><strong>Can't handle checked exceptions</strong>. Lambdas aren't actually forbidden from throwing checked exceptions, but common functional interfaces like <code>Consumer</code> don't declare any. Therefore, any code that throws checked exceptions must wrap them in <code>try-catch</code> or <code>Throwables.propagate()</code>. But even if you do that, it's not always clear what happens to the thrown exception. It could get swallowed somewhere in the guts of <code>forEach()</code></p></li>\n<li><p><strong>Limited flow-control</strong>. A <code>return</code> in a lambda equals a <code>continue</code> in a for-each, but there is no equivalent to a <code>break</code>. It's also difficult to do things like return values,  short circuit, or <em>set flags</em> (which would have alleviated things a bit, if it wasn't a violation of the <em>no non-final variables</em> rule). <a href=\"http://journal.stuffwithstuff.com/2013/01/13/iteration-inside-and-out/\">\"This is not just an optimization, but critical when you consider that some sequences (like reading the lines in a file) may have side-effects, or you may have an infinite sequence.\"</a></p></li>\n<li><p><strong>Might execute in parallel</strong>, which is a horrible, horrible thing for all but the 0.1% of your code that needs to be optimized. Any parallel code has to be thought through (even if it doesn't use locks, volatiles, and other particularly nasty aspects of traditional multi-threaded execution). Any bug will be tough to find.</p></li>\n<li><p><strong>Might hurt performance</strong>, because the JIT can't optimize forEach()+lambda to the same extent as plain loops, especially now that lambdas are new. By \"optimization\" I do not mean the overhead of calling lambdas (which is small), but to the sophisticated analysis and transformation that the modern JIT compiler performs on running code.</p></li>\n<li><p><strong>If you do need parallelism,  it is probably much faster and not much more difficult to use an ExecutorService</strong>. Streams are both automagical (read: don't know much about your problem) <em>and</em> use a specialized (read: inefficient for the general case) parallelization strategy (<a href=\"https://programmers.stackexchange.com/questions/250169/is-the-fork-join-framework-a-bad-match-for-the-java-8-streams-api\">fork-join recursive decomposition</a>).</p></li>\n<li><p><strong>Makes debugging more confusing</strong>, because of the nested call hierarchy and, god forbid, parallel execution. The debugger may have issues displaying variables from the surrounding code, and things like step-through may not work as expected.</p></li>\n<li><p><strong>Streams in general are more difficult to code, read, and debug</strong>. Actually, this is true of complex \"<a href=\"https://en.wikipedia.org/wiki/Fluent_interface\">fluent</a>\" APIs in general. The combination of complex single statements, heavy use of generics, and lack of intermediate variables conspire to produce confusing error messages and frustrate debugging. Instead of \"this method doesn't have an overload for type X\" you get an error message closer to \"somewhere you messed up the types, but we don't know where or how.\" Similarly, you can't step through and examine things in a debugger as easily as when the code is broken into multiple statements, and intermediate values are saved to variables. Finally, reading the code and understanding the types and behavior at each stage of execution may be non-trivial.</p></li>\n<li><p><strong>Sticks out like a sore thumb</strong>. The Java language already has the for-each statement. Why replace it with a function call? Why encourage hiding side-effects somewhere in expressions? Why encourage unwieldy one-liners? Mixing regular for-each and new forEach willy-nilly is bad style. Code should speak in idioms (patterns that are quick to comprehend due to their repetition), and the fewer idioms are used the clearer the code is and less time is spent deciding which idiom to use (a big time-drain for perfectionists like myself!).</p></li>\n</ul>\n\n<p>As you can see, I'm not a big fan of the forEach() except in cases when it makes sense.</p>\n\n<p>Particularly offensive to me is the fact that <code>Stream</code> does not implement <code>Iterable</code> (despite actually having method <code>iterator</code>) and cannot be used in a for-each, only with a forEach(). I recommend casting Streams into Iterables with <code>(Iterable&lt;T&gt;)stream::iterator</code>. A better alternative is to use <a href=\"https://github.com/amaembo/streamex\">StreamEx</a> which fixes a number of Stream API problems, including implementing <code>Iterable</code>.</p>\n\n<p>That said, <code>forEach()</code> is useful for the following:</p>\n\n<ul>\n<li><p><strong>Atomically iterating over a synchronized list</strong>. Prior to this, a list generated with <code>Collections.synchronizedList()</code> was atomic with respect to things like get or set, but was not thread-safe when iterating.</p></li>\n<li><p><strong>Parallel execution (using an appropriate parallel stream)</strong>. This saves you a few lines of code vs using an ExecutorService, if your problem matches the performance assumptions built into Streams and Spliterators.</p></li>\n<li><p><strong>Specific containers which</strong>, like the synchronized list, benefit from being in control of iteration (although this is largely theoretical unless people can bring up more examples)</p></li>\n<li><p><strong>Calling a single function more cleanly</strong> by using <code>forEach()</code> and a method reference argument (ie, <code>list.forEach (obj::someMethod)</code>). However, keep in mind the points on checked exceptions, more difficult debugging, and reducing the number of idioms you use when writing code.</p></li>\n</ul>\n\n<p>Articles I used for reference:</p>\n\n<ul>\n<li><a href=\"http://www.techempower.com/blog/2013/03/26/everything-about-java-8/\">Everything about Java 8</a></li>\n<li><a href=\"http://journal.stuffwithstuff.com/2013/01/13/iteration-inside-and-out/\">Iteration Inside and Out</a> (as pointed out by another poster)</li>\n</ul>\n\n<p><strong>EDIT:</strong> Looks like some of the original proposals for lambdas (such as <a href=\"http://www.javac.info/closures-v06a.html\">http://www.javac.info/closures-v06a.html</a>) solved some of the issues I mentioned (while adding their own complications, of course).</p>\n", "title": "Java 8 Iterable.forEach() vs foreach loop", "tags": ["java", "for-loop", "java-8"], "link": "http://stackoverflow.com/questions/16635398/java-8-iterable-foreach-vs-foreach-loop/20177092#20177092", "post_type": "answer", "question_id": 16635398, "answer_id": 20177092}, {"body": "<p>When reading this question one can get the impression, that <code>Iterable#forEach</code> in combination with lambda expressions is a shortcut/replacement for writing a traditional for-each loop. This is simply not true. This code from the OP:</p>\n\n<pre><code>joins.forEach(join -&gt; mIrc.join(mSession, join));\n</code></pre>\n\n<p>is <strong>not</strong> intended as a shortcut for writing</p>\n\n<pre><code>for (String join : joins) {\n    mIrc.join(mSession, join);\n}\n</code></pre>\n\n<p>and should certainly not be used in this way. Instead it is intended as a shortcut (although it is <em>not</em> exactly the same) for writing</p>\n\n<pre><code>joins.forEach(new Consumer&lt;T&gt;() {\n    @Override\n    public void accept(T join) {\n        mIrc.join(mSession, join);\n    }\n});\n</code></pre>\n\n<p>And it is as a replacement for the following Java 7 code:</p>\n\n<pre><code>final Consumer&lt;T&gt; c = new Consumer&lt;T&gt;() {\n    @Override\n    public void accept(T join) {\n        mIrc.join(mSession, join);\n    }\n};\nfor (T t : joins) {\n    c.accept(t);\n}\n</code></pre>\n\n<p>Replacing the body of a loop with a functional interface, as in the examples above, makes your code more explicit: You are saying that (1) the body of the loop does not affect the surrounding code and control flow, and (2) the body of the loop may be replaced with a different implementation of the function, without affecting the surrounding code. Not being able to access non final variables of the outer scope is not a deficit of functions/lambdas, it is a <strong>feature</strong> that distinguishes the semantics of <code>Iterable#forEach</code> from the semantics of a traditional for-each loop. Once one gets used to the syntax of <code>Iterable#forEach</code>, it makes the code more readable, because you immediately get this additional information about the code.</p>\n\n<p>Traditional for-each loops will certainly stay <em>good practice</em> (to avoid the overused term \"<a href=\"http://en.wikipedia.org/wiki/Best_practice\">best practice</a>\") in Java. But this doesn't mean, that <code>Iterable#forEach</code> should be considered bad practice or bad style. It is always good practice, to use the right tool for doing the job, and this includes mixing traditional for-each loops with <code>Iterable#forEach</code>, where it makes sense.</p>\n\n<p>Since the downsides of <code>Iterable#forEach</code> have already been discussed in this thread, here are some reasons, why you might probably want to use <code>Iterable#forEach</code>:</p>\n\n<ul>\n<li><p><strong>To make your code more explicit:</strong> As described above, <code>Iterable#forEach</code> <em>can</em> make your code more explicit and readable in some situations.</p></li>\n<li><p><strong>To make your code more extensible and maintainable:</strong> Using a function as the body of a loop allows you to replace this function with different implementations (see <a href=\"http://en.wikipedia.org/wiki/Strategy_pattern\">Strategy Pattern</a>). You could e.g. easily replace the lambda expression with a method call, that may be overwritten by sub-classes:</p>\n\n<pre><code>joins.forEach(getJoinStrategy());\n</code></pre>\n\n<p>Then you could provide default strategies using an enum, that implements the functional interface. This not only makes your code more extensible, it also increases maintainability because it decouples the loop implementation from the loop declaration. </p></li>\n<li><p><strong>To make your code more debuggable:</strong> Seperating the loop implementation from the declaration can also make debugging more easy, because you could have a specialized debug implementation, that prints out debug messages, without the need to clutter your main code with <code>if(DEBUG)System.out.println()</code>. The debug implementation could e.g. be a <a href=\"http://en.wikipedia.org/wiki/Delegation_pattern\">delegate</a>, that <a href=\"http://en.wikipedia.org/wiki/Decorator_pattern\">decorates</a> the actual function implementation. </p></li>\n<li><p><strong>To optimize performance-critical code:</strong> Contrary to some of the assertions in this thread, <code>Iterable#forEach</code> <em>does</em> already provide better performance than a traditional for-each loop, at least when using ArrayList and running Hotspot in \"-client\" mode. While this performance boost is small and negligible for most use cases, there are situations, where this extra performance can make a difference. E.g. library maintainers will certainly want to evaluate, if some of their existing loop implementations should be replaced with <code>Iterable#forEach</code>.</p>\n\n<p>To back this statement up with facts, I have done some micro-benchmarks with <a href=\"https://code.google.com/p/caliper/\">Caliper</a>. Here is the test code (latest Caliper from git is needed):</p>\n\n<pre><code>@VmOptions(\"-server\")\npublic class Java8IterationBenchmarks {\n\n    public static class TestObject {\n        public int result;\n    }\n\n    public @Param({\"100\", \"10000\"}) int elementCount;\n\n    ArrayList&lt;TestObject&gt; list;\n    TestObject[] array;\n\n    @BeforeExperiment\n    public void setup(){\n        list = new ArrayList&lt;&gt;(elementCount);\n        for (int i = 0; i &lt; elementCount; i++) {\n            list.add(new TestObject());\n        }\n        array = list.toArray(new TestObject[list.size()]);\n    }\n\n    @Benchmark\n    public void timeTraditionalForEach(int reps){\n        for (int i = 0; i &lt; reps; i++) {\n            for (TestObject t : list) {\n                t.result++;\n            }\n        }\n        return;\n    }\n\n    @Benchmark\n    public void timeForEachAnonymousClass(int reps){\n        for (int i = 0; i &lt; reps; i++) {\n            list.forEach(new Consumer&lt;TestObject&gt;() {\n                @Override\n                public void accept(TestObject t) {\n                    t.result++;\n                }\n            });\n        }\n        return;\n    }\n\n    @Benchmark\n    public void timeForEachLambda(int reps){\n        for (int i = 0; i &lt; reps; i++) {\n            list.forEach(t -&gt; t.result++);\n        }\n        return;\n    }\n\n    @Benchmark\n    public void timeForEachOverArray(int reps){\n        for (int i = 0; i &lt; reps; i++) {\n            for (TestObject t : array) {\n                t.result++;\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>And here are the results:</p>\n\n<ul>\n<li><a href=\"https://microbenchmarks.appspot.com/runs/75b4e5a3-e94b-41e2-85cc-c3211baa8b6f#r:scenario.benchmarkSpec.methodName&amp;c:scenario.benchmarkSpec.parameters.elementCount\">Results for -client</a></li>\n<li><a href=\"https://microbenchmarks.appspot.com/runs/1c1f2842-b0b3-4b59-9bf3-404741d6b4ea#r:scenario.benchmarkSpec.methodName&amp;c:scenario.benchmarkSpec.parameters.elementCount\">Results for -server</a></li>\n</ul>\n\n<p>When running with \"-client\", <code>Iterable#forEach</code> outperforms the traditional for loop over an ArrayList, but is still slower than directly iterating over an array. When running with \"-server\", the performance of all approaches is about the same.</p></li>\n<li><p><strong>To provide optional support for parallel execution:</strong> It has already been said here, that the possibility to execute the functional interface of <code>Iterable#forEach</code> in parallel using <a href=\"http://download.java.net/lambda/b86/docs/api/java/util/stream/package-summary.html\">streams</a>, is certainly an important aspect. Since <code>Collection#parallelStream()</code> does not guarantee, that the loop is actually executed in parallel, one must consider this an <em>optional</em> feature. By iterating over your list with <code>list.parallelStream().forEach(...);</code>, you explicitly say: This loop <em>supports</em> parallel execution, but it does not depend on it. Again, this is a feature and not a deficit!</p>\n\n<p>By moving the decision for parallel execution away from your actual loop implementation, you allow optional optimization of your code, without affecting the code itself, which is a good thing. Also, if the default parallel stream implementation does not fit your needs, no one is preventing you from providing your own implementation. You could e.g. provide an optimized collection depending on the underlying operating system, on the size of the collection, on the number of cores, and on some preference settings: </p>\n\n<pre><code>public abstract class MyOptimizedCollection&lt;E&gt; implements Collection&lt;E&gt;{\n    private enum OperatingSystem{\n        LINUX, WINDOWS, ANDROID\n    }\n    private OperatingSystem operatingSystem = OperatingSystem.WINDOWS;\n    private int numberOfCores = Runtime.getRuntime().availableProcessors();\n    private Collection&lt;E&gt; delegate;\n\n    @Override\n    public Stream&lt;E&gt; parallelStream() {\n        if (!System.getProperty(\"parallelSupport\").equals(\"true\")) {\n            return this.delegate.stream();\n        }\n        switch (operatingSystem) {\n            case WINDOWS:\n                if (numberOfCores &gt; 3 &amp;&amp; delegate.size() &gt; 10000) {\n                    return this.delegate.parallelStream();\n                }else{\n                    return this.delegate.stream();\n                }\n            case LINUX:\n                return SomeVerySpecialStreamImplementation.stream(this.delegate.spliterator());\n            case ANDROID:\n            default:\n                return this.delegate.stream();\n        }\n    }\n}\n</code></pre>\n\n<p>The nice thing here is, that your loop implementation doesn't need to know or care about these details.</p></li>\n</ul>\n", "title": "Java 8 Iterable.forEach() vs foreach loop", "tags": ["java", "for-loop", "java-8"], "link": "http://stackoverflow.com/questions/16635398/java-8-iterable-foreach-vs-foreach-loop/22502206#22502206", "post_type": "answer", "question_id": 16635398, "answer_id": 22502206}, {"body": "<p><em>TL;DR</em>: <code>List.stream().forEach()</code> was the fastest.</p>\n\n<p>I felt I should add my results from benchmarking iteration.\nI took a very simple approach (no benchmarking frameworks) and benchmarked 5 different methods:</p>\n\n<ol>\n<li>classic <code>for</code></li>\n<li>classic foreach</li>\n<li><code>List.forEach()</code></li>\n<li><code>List.stream().forEach()</code></li>\n<li><code>List.parallelStream().forEach</code></li>\n</ol>\n\n<h2>the testing procedure and parameters</h2>\n\n<pre><code>private List&lt;Integer&gt; list;\nprivate final int size = 1_000_000;\n\npublic MyClass(){\n    list = new ArrayList&lt;&gt;();\n    Random rand = new Random();\n    for (int i = 0; i &lt; size; ++i) {\n        list.add(rand.nextInt(size * 50));\n    }    \n}\nprivate void doIt(Integer i) {\n    i *= 2; //so it won't get JITed out\n}\n</code></pre>\n\n<p>The list in this class shall be iterated over and have some <code>doIt(Integer i)</code> applied to all it's members, each time via a different method.\nin the Main class I run the tested method three times to warm up the JVM. I then run the test method 1000 times summing the time it takes for each iteration method (using <code>System.nanoTime()</code>). After that's done i divide that sum by 1000 and that's the result, average time.\nexample:</p>\n\n<pre><code>myClass.fored();\nmyClass.fored();\nmyClass.fored();\nfor (int i = 0; i &lt; reps; ++i) {\n    begin = System.nanoTime();\n    myClass.fored();\n    end = System.nanoTime();\n    nanoSum += end - begin;\n}\nSystem.out.println(nanoSum / reps);\n</code></pre>\n\n<p>I ran this on a i5 4 core CPU, with java version 1.8.0_05</p>\n\n<h2>classic <code>for</code></h2>\n\n<pre><code>for(int i = 0, l = list.size(); i &lt; l; ++i) {\n    doIt(list.get(i));\n}\n</code></pre>\n\n<p>execution time: 4.21 ms</p>\n\n<h2>classic foreach</h2>\n\n<pre><code>for(Integer i : list) {\n    doIt(i);\n}\n</code></pre>\n\n<p>execution time: 5.95 ms</p>\n\n<h2><code>List.forEach()</code></h2>\n\n<pre><code>list.forEach((i) -&gt; doIt(i));\n</code></pre>\n\n<p>execution time: 3.11 ms</p>\n\n<h2><code>List.stream().forEach()</code></h2>\n\n<pre><code>list.stream().forEach((i) -&gt; doIt(i));\n</code></pre>\n\n<p>execution time: 2.79 ms</p>\n\n<h2><code>List.parallelStream().forEach</code></h2>\n\n<pre><code>list.parallelStream().forEach((i) -&gt; doIt(i));\n</code></pre>\n\n<p>execution time: 3.6 ms</p>\n", "title": "Java 8 Iterable.forEach() vs foreach loop", "tags": ["java", "for-loop", "java-8"], "link": "http://stackoverflow.com/questions/16635398/java-8-iterable-foreach-vs-foreach-loop/25855691#25855691", "post_type": "answer", "question_id": 16635398, "answer_id": 25855691}, {"body": "<p>One of most upleasing functional <code>forEach</code>'s limitations is lack of checked exceptions support.</p>\n\n<p>One <a href=\"http://stackoverflow.com/questions/31702989/how-to-iterate-with-foreach-loop-over-java-8-stream\">possible workaround</a> is to replace terminal <code>forEach</code> with plain old foreach loop:</p>\n\n<pre><code>    Stream&lt;String&gt; stream = Stream.of(\"\", \"1\", \"2\", \"3\").filter(s -&gt; !s.isEmpty());\n    Iterable&lt;String&gt; iterable = stream::iterator;\n    for (String s : iterable) {\n        fileWriter.append(s);\n    }\n</code></pre>\n\n<p>Here is list of most popular questions with other workarounds on checked exception handling within lambdas and streams:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/18198176/java-8-lambda-function-that-throws-exception\">Java 8 Lambda function that throws exception?</a></p>\n\n<p><a href=\"http://stackoverflow.com/questions/19757300/java-8-lambda-streams-filter-by-method-with-exception\">Java 8: Lambda-Streams, Filter by Method with Exception</a></p>\n\n<p><a href=\"http://stackoverflow.com/questions/27644361/how-can-i-throw-checked-exceptions-from-inside-java-8-streams\">How can I throw CHECKED exceptions from inside Java 8 streams?</a></p>\n\n<p><a href=\"http://stackoverflow.com/questions/14039995/java-8-mandatory-checked-exceptions-handling-in-lambda-expressions-why-mandato\">Java 8: Mandatory checked exceptions handling in lambda expressions. Why mandatory, not optional?</a></p>\n", "title": "Java 8 Iterable.forEach() vs foreach loop", "tags": ["java", "for-loop", "java-8"], "link": "http://stackoverflow.com/questions/16635398/java-8-iterable-foreach-vs-foreach-loop/31707746#31707746", "post_type": "answer", "question_id": 16635398, "answer_id": 31707746}, {"body": "<p>If you make <code>foo</code> static, you must initialize it in the class constructor (or inline where you define it) like the following examples.</p>\n\n<p><strong>Class constructor (not instance):</strong></p>\n\n<pre><code>private static final List foo;\n\nstatic\n{\n   foo = new ArrayList();\n}\n</code></pre>\n\n<p><strong>Inline:</strong></p>\n\n<pre><code>private static final List foo = new ArrayList();\n</code></pre>\n\n<p>The problem here is not how the <code>final</code> modifier works, but rather how the <code>static</code> modifier works. </p>\n\n<p>The <code>final</code> modifier enforces an initialization of your reference by the time the call to your constructor completes (i.e. you must initialize it in the constructor).</p>\n\n<p>When you initialize an attribute in-line, it gets initialized before the code you have defined for the constructor is run, so you get the following outcomes:</p>\n\n<ul>\n<li>if <code>foo</code> is <code>static</code>, <code>foo = new ArrayList()</code> will be executed before the <code>static{}</code> constructor you have defined for your class is executed</li>\n<li>if <code>foo</code> is not <code>static</code>, <code>foo = new ArrayList()</code> will be executed before your constructor is run</li>\n</ul>\n\n<p>When you do not initilize an attribute in-line, the <code>final</code> modifier enforces that you initialize it and that you must do so in the constructor. If you also have a <code>static</code> modifier, the constructor you will have to initialize the attribute in is the class' initialization block : <code>static{}</code>.</p>\n\n<p>The error you get in your code is from the fact that <code>static{}</code> is run when the class is loaded, before the time you instantiate an object of that class. Thus, you will have not initialized <code>foo</code> when the class is created. </p>\n\n<p>Think of the <code>static{}</code> block as a constructor for an object of type <code>Class</code>. This is where you must do the initialization of your <code>static final</code> class attributes (if not done inline).</p>\n\n<p><strong>Side note:</strong></p>\n\n<p>The <code>final</code> modifier assures const-ness only for primitive types and references. </p>\n\n<p>When you declare a <code>final</code> object, what you get is a <code>final</code> <strong>reference</strong> to that object, but the object itself is not constant. </p>\n\n<p>What you are really achieving when declaring a <code>final</code> attribute is that, once you declare an object for your specific purpose (like the <code>final List</code> that you have declared), that and only that object will be used for that purpose: you will not be able to change <code>List foo</code> to another <code>List</code>, but you can still alter your <code>List</code> by adding/removing items (the <code>List</code> you are using will be the same, only with its contents altered).</p>\n", "title": "How final keyword works", "tags": ["java", "final"], "link": "http://stackoverflow.com/questions/15655012/how-final-keyword-works/15655071#15655071", "post_type": "answer", "question_id": 15655012, "answer_id": 15655071}, {"body": "<p>This is <strong>favorite interview question</strong>. Interviewer tries to find out here, how much you understand about behavior of objects with respect to constructors, methods, class variables(static variables), instance variables.<br></p>\n\n<pre><code>import java.util.ArrayList;\nimport java.util.List;\n\nclass Test {\n    private final List foo;\n\n    public Test() {\n        foo = new ArrayList();\n        foo.add(\"foo\"); // Modification-1\n    }\n\n    public void setFoo(List foo) {\n//      this.foo = foo;  //compile time error.\n    }\n}\n</code></pre>\n\n<p>In above case we have defined <code>Test</code> constructor and <code>setFoo</code> method. <br>\n<strong>About constructor:</strong>  Constructor can be invoked only <strong>one</strong> time per object creation by using <code>new</code> keyword. Programmer cannot invoke constructor many times because constructor are designed so. <br>\n<strong>About method:</strong> Method can be invoked as many time as programmer wants and compiler knows it programmer may invoke method zero or multiple time. <br></p>\n\n<p><strong>Scenario 1</strong><br></p>\n\n<pre><code>private final List foo;  // 1\n</code></pre>\n\n<p><code>foo</code> is an <strong>instance</strong> variable. When we create <code>Test</code> class' object then instance variable <code>foo</code> will be copied inside object of Test class. If we assign <code>foo</code> inside constructor then compiler know that Constructor will be invoked only one time. so there is no problem to assign it inside constructor.\n<br><br>\nIf we assign <code>foo</code> inside method then compiler knows that method may be invoked multiple time. So value will have to be changed multiple time which is not allowed for <code>final</code> variable. You can assign value to the final variable only one time. So compiler decides constructor is good choice!</p>\n\n<p><strong>Scenario 2</strong></p>\n\n<pre><code>private static final List foo = new ArrayList();\n</code></pre>\n\n<p><code>foo</code> is now <strong>static</strong> variable. When we create object of <code>Test</code> class then <code>foo</code> will not be copied to the object of <code>Test</code> class because <code>foo</code> is static. Now <code>foo</code> is not the property of each object. This is the property of Test class. But <code>foo</code> can be seen by many objects and if every object which is created by using new keyword which ultimately invoke <code>Test</code> constructor then value will be changed at the time of multiple object creation (Remember <code>static foo</code> is not copied in every object now but is shared between multiple objects.) <br></p>\n\n<p><strong>Scenario 3</strong> <br></p>\n\n<pre><code>t.foo.add(\"bar\"); // Modification-2\n</code></pre>\n\n<p>Above <code>Modification-2</code> is from your question. In above case you are not changing first referenced object but you are adding contents inside <code>foo</code> which is allowed. Compiler complains if you try to assign <code>new ArrayList()</code> object to the <code>foo</code> reference variable.<br>\n<strong>Rule</strong> is that if you have initialized object to <code>final</code> reference variable then you cannot change it to refer different <code>ArrayList</code> object. (in this case ArrayList)</p>\n\n<p><strong>final</strong> class cannot be subclassed<br>\n<strong>final</strong> methods cannot be overridden. (This method is in superclass)<br>\n<strong>final</strong> methods can override. (Read this in grammatical way. This method is in subclass)</p>\n", "title": "How final keyword works", "tags": ["java", "final"], "link": "http://stackoverflow.com/questions/15655012/how-final-keyword-works/15656208#15656208", "post_type": "answer", "question_id": 15655012, "answer_id": 15656208}, {"body": "<p>First of all, the place in your code where you are initializing (i.e. assigning for the first time) foo is here:</p>\n\n<pre><code>foo = new ArrayList();\n</code></pre>\n\n<p>foo is an object (with type List) so it is a <em>reference</em> type, not a <em>value</em> type (like int). As such, it holds a reference to a memory location (e.g. 0xA7D2A834) where your List elements are stored. Lines like this</p>\n\n<pre><code>foo.add(\"foo\"); // Modification-1\n</code></pre>\n\n<p>do not change the value of foo (which, again, is just a reference to a memory location). Instead, they just add elements into that referenced memory location. To violate the <em>final</em> keyword, you would have to try to re-assign foo as follows again:</p>\n\n<pre><code>foo = new ArrayList();\n</code></pre>\n\n<p>That <em>would</em> give you a compilation error.</p>\n\n<hr>\n\n<p>Now, with that out of the way, think about what happens when you add the <em>static</em> keyword. </p>\n\n<p>When you do NOT have the static keyword, each object that instantiates the class has its own copy of foo. Therefore, the constructor assigns a value to a blank, fresh copy of the foo variable, which is perfectly fine.</p>\n\n<p>However, when you DO have the static keyword, only one foo exists in memory that is associated with the class. If you were to create two or more objects, the constructor would be attempting to re-assign that one foo each time, violating the <em>final</em> keyword.</p>\n", "title": "How final keyword works", "tags": ["java", "final"], "link": "http://stackoverflow.com/questions/15655012/how-final-keyword-works/24895623#24895623", "post_type": "answer", "question_id": 15655012, "answer_id": 24895623}, {"body": "<blockquote>\n  <p>Obviously the write to currentPos doesn't happen-before the read of it, but I don't see how that can be the issue.</p>\n</blockquote>\n\n<p><code>currentPos = new Point(currentPos.x+1, currentPos.y+1);</code> does a few things, including writing default values to <code>x</code> and <code>y</code> (0) and then writing their initial values in the constructor. Since your object is not safely published those 4 write operations can be freely reordered by the compiler / JVM.</p>\n\n<p>So from the perspective of the reading thread, it is a legal execution to read <code>x</code> with its new value but <code>y</code> with its default value of 0 for example. By the time you reach the <code>println</code> statement (which by the way is synchronized and therefore does influence the read operations), the variables have their initial values and the program prints the expected values.</p>\n\n<p>Marking <code>currentPos</code> as <code>volatile</code> will ensure safe publication since your object is effectively immutable - if in your real use case the object is mutated after construction, <code>volatile</code> guarantees won't be enough and you could see an inconsistent object again.</p>\n\n<p>Alternatively, you can make the <code>Point</code> immutable which will also ensure safe publication, even without using <code>volatile</code>. To achieve immutability, you simply need to mark <code>x</code> and <code>y</code> final.</p>\n\n<p>As a side note and as already mentioned, <code>synchronized(this) {}</code> can be treated as a no-op by the JVM (I understand you included it to reproduce the behaviour).</p>\n", "title": "Why does this Java program terminate despite that apparently it shouldn&#39;t (and didn&#39;t)?", "tags": ["java", "concurrency", "order", "java-memory-model", "memory-visibility"], "link": "http://stackoverflow.com/questions/16159203/why-does-this-java-program-terminate-despite-that-apparently-it-shouldnt-and-d/16323196#16323196", "post_type": "answer", "question_id": 16159203, "answer_id": 16323196}, {"body": "<p>You have ordinary memory, the 'currentpos' reference and the Point object and its fields behind it, shared between 2 threads, without synchronisation. Thus, there is no defined ordering between the writes that happen to this memory in the main thread and the reads in the created thread (call it T).</p>\n\n<p>Main thread is doing the following writes (ignoring the initial setup of point, will result in p.x and p.y having default values):</p>\n\n<ul>\n<li>to p.x</li>\n<li>to p.y </li>\n<li>to currentpos</li>\n</ul>\n\n<p>Because there is nothing special about these writes in terms of synchronisation/barriers, the runtime is free to allow the T thread see them occur in any order (the main thread of course always sees writes and reads ordered according to programme order), and occur at any point between the reads in T.</p>\n\n<p>So T is doing:</p>\n\n<ol>\n<li>reads currentpos to p</li>\n<li>read p.x and p.y (in either order)</li>\n<li>compare, and take the branch</li>\n<li>read p.x and p.y (either order) and call System.out.println</li>\n</ol>\n\n<p>Given there's no ordering relationships between the writes in main, and the reads in T, there are clearly several ways this can produce your result, as T may see main's write to currentpos <em>before</em> the writes to currentpos.y or currentpos.x:</p>\n\n<ol>\n<li>It reads currentpos.x first, before the x write has occurred - gets 0, then reads currentpos.y before the y write has occurred - gets 0. Compare evals to true. The writes\nbecome visible to T. System.out.println is called.</li>\n<li>It reads currentpos.x first, after the x write has occurred, then reads currentpos.y before the y write has occurred - gets 0. Compare evals to true. Writes become visible to T... etc.</li>\n<li>It reads currentpos.y first, before the y write has occurred (0), then reads currentpos.x after the x write, evals to true. etc.</li>\n</ol>\n\n<p>and so on... There are a number of data races here.</p>\n\n<p>I suspect the flawed assumption here is thinking that the writes that result from this line are made visible across all the threads in the programme order of the thread executing it:</p>\n\n<pre><code>currentPos = new Point(currentPos.x+1, currentPos.y+1);\n</code></pre>\n\n<p>Java makes no such guarantee (it'd be terrible for performance). Something more must be added if your programme needs a guaranteed ordering of the writes relative to reads in other threads. Others have suggested making the x,y fields final, or alternatively making currentpos volatile.</p>\n\n<ul>\n<li>If you make the x,y fields final, then Java guarantees that the writes of their values will be seen to occur before the constructor returns, in all threads. Thus, as the assignment to currentpos is after the constructor, the T thread is guaranteed to see the writes in the correct order.</li>\n<li>If you make currentpos volatile, then Java guarantees that that this is a synchronisation point which will be total-ordered wrt other synchronisation points. As in main the writes to x and y must happen before the write to currentpos, then any read of currentpos in another thread must see also the writes of x, y that happened before.</li>\n</ul>\n\n<p>Using final has the advantage that it makes the fields immutable, and thus allows the values to be cached. Using volatile leads to synchronisation on every write and read of currentpos, which might hurt performance.</p>\n\n<p>See chapter 17 of the Java Language Spec for the gory details:<a href=\"http://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html\">http://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html</a> </p>\n\n<p>(Initial answer assumed a weaker memory model, as I was not sure the JLS guaranteed volatile was sufficient. Answer edited to reflect comment from assylias, pointing out the Java model is stronger - happens-before is transitive - and so volatile on currentpos also suffices).</p>\n", "title": "Why does this Java program terminate despite that apparently it shouldn&#39;t (and didn&#39;t)?", "tags": ["java", "concurrency", "order", "java-memory-model", "memory-visibility"], "link": "http://stackoverflow.com/questions/16159203/why-does-this-java-program-terminate-despite-that-apparently-it-shouldnt-and-d/18258659#18258659", "post_type": "answer", "question_id": 16159203, "answer_id": 18258659}, {"body": "<p>'Random' is more than just about getting numbers.... what you have is <a href=\"http://en.wikipedia.org/wiki/Pseudorandomness\" rel=\"nofollow\">pseudo-random</a></p>\n\n<p>If pseudo-random is good enough for your purposes, then sure, it's way faster (and XOR+Bitshift will be faster than what you have)</p>\n\n<p>Rolf</p>\n\n<p>Edit:</p>\n\n<p>OK, after being too hasty in this answer, let me answer the real reason why your code is faster:</p>\n\n<p>From the JavaDoc for Math.Random() </p>\n\n<blockquote>\n  <p>This method is properly synchronized to allow correct use by more than one thread. However, if many threads need to generate pseudorandom numbers at a great rate, it may reduce contention for each thread to have its own pseudorandom-number generator.</p>\n</blockquote>\n\n<p>This is likely why your code is faster.</p>\n", "title": "Is this a &quot;good enough&quot; random algorithm; why isn&#39;t it used if it&#39;s faster?", "tags": ["java", "performance", "algorithm", "random"], "link": "http://stackoverflow.com/questions/14491966/is-this-a-good-enough-random-algorithm-why-isnt-it-used-if-its-faster/14492043#14492043", "post_type": "answer", "question_id": 14491966, "answer_id": 14492043}, {"body": "<p>Your <code>QuickRandom</code> implementation hasn't really an uniform distribution. The frequencies are generally higher at the lower values while <code>Math.random()</code> has a more uniform distribution. Here's a <a href=\"http://sscce.org\">SSCCE</a> which shows that:</p>\n\n<pre><code>package com.stackoverflow.q14491966;\n\nimport java.util.Arrays;\n\npublic class Test {\n\n    public static void main(String[] args) throws Exception {\n        QuickRandom qr = new QuickRandom();\n        int[] frequencies = new int[10];\n        for (int i = 0; i &lt; 100000; i++) {\n            frequencies[(int) (qr.random() * 10)]++;\n        }\n        printDistribution(\"QR\", frequencies);\n\n        frequencies = new int[10];\n        for (int i = 0; i &lt; 100000; i++) {\n            frequencies[(int) (Math.random() * 10)]++;\n        }\n        printDistribution(\"MR\", frequencies);\n    }\n\n    public static void printDistribution(String name, int[] frequencies) {\n        System.out.printf(\"%n%s distribution |8000     |9000     |10000    |11000    |12000%n\", name);\n        for (int i = 0; i &lt; 10; i++) {\n            char[] bar = \"                                                  \".toCharArray(); // 50 chars.\n            Arrays.fill(bar, 0, Math.max(0, Math.min(50, frequencies[i] / 100 - 80)), '#');\n            System.out.printf(\"0.%dxxx: %6d  :%s%n\", i, frequencies[i], new String(bar));\n        }\n    }\n\n}\n</code></pre>\n\n<p>The average result looks like this:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>QR distribution |8000     |9000     |10000    |11000    |12000\n0.0xxx:  11376  :#################################                 \n0.1xxx:  11178  :###############################                   \n0.2xxx:  11312  :#################################                 \n0.3xxx:  10809  :############################                      \n0.4xxx:  10242  :######################                            \n0.5xxx:   8860  :########                                          \n0.6xxx:   9004  :##########                                        \n0.7xxx:   8987  :#########                                         \n0.8xxx:   9075  :##########                                        \n0.9xxx:   9157  :###########                                       \n\nMR distribution |8000     |9000     |10000    |11000    |12000\n0.0xxx:  10097  :####################                              \n0.1xxx:   9901  :###################                               \n0.2xxx:  10018  :####################                              \n0.3xxx:   9956  :###################                               \n0.4xxx:   9974  :###################                               \n0.5xxx:  10007  :####################                              \n0.6xxx:  10136  :#####################                             \n0.7xxx:   9937  :###################                               \n0.8xxx:  10029  :####################                              \n0.9xxx:   9945  :###################    \n</code></pre>\n\n<p>If you repeat the test, you'll see that the QR distribution varies heavily, depending on the initial seeds, while the MR distribution is stable. Sometimes it reaches the desired uniform distribution, but more than often it doesn't. Here's one of the more extreme examples, it's even beyond the borders of the graph:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>QR distribution |8000     |9000     |10000    |11000    |12000\n0.0xxx:  41788  :##################################################\n0.1xxx:  17495  :##################################################\n0.2xxx:  10285  :######################                            \n0.3xxx:   7273  :                                                  \n0.4xxx:   5643  :                                                  \n0.5xxx:   4608  :                                                  \n0.6xxx:   3907  :                                                  \n0.7xxx:   3350  :                                                  \n0.8xxx:   2999  :                                                  \n0.9xxx:   2652  :                                                  \n</code></pre>\n", "title": "Is this a &quot;good enough&quot; random algorithm; why isn&#39;t it used if it&#39;s faster?", "tags": ["java", "performance", "algorithm", "random"], "link": "http://stackoverflow.com/questions/14491966/is-this-a-good-enough-random-algorithm-why-isnt-it-used-if-its-faster/14492320#14492320", "post_type": "answer", "question_id": 14491966, "answer_id": 14492320}, {"body": "<p>If the <code>Math.Random()</code> function calls the operating system to get the time of day, then you cannot compare it to your function. Your function is a PRNG, whereas that function is striving for real random numbers. Apples and oranges.</p>\n\n<p>Your PRNG may be fast, but it does not have enough state information to achieve a long period before it repeats (and its logic is not sophisticated enough to even achieve the periods that are possible with that much state information).</p>\n\n<p>Period is the length of the sequence before your PRNG begins to repeat itself.  This happens as soon as the PRNG machine makes a state transition to a state which is identical to some past state. From there, it will repeat the transitions which began in that state. Another problem with PRNG's can be a low number of unique sequences, as well as degenerate convergence on a particular sequence which repeats. There can also be undesirable patterns. For instance, suppose that a PRNG looks fairly random when the numbers are printed in decimal, but an inspection of the values in binary shows that bit 4 is simply toggling between 0 and 1 on each call. Oops!</p>\n\n<p>Take a look at the Mersenne Twister and other algorithms. There are ways to strike a balance between the period length and CPU cycles. One basic approach (used in the Mersenne Twister) is to cycle around in the state vector. That is to say, when a number is being generated, it is not based on the entire state, just on a few words from the state array subject to a few bit operations. But at each step, the algorithm also moves around in the array, scrambling the contents a little bit at a time.</p>\n", "title": "Is this a &quot;good enough&quot; random algorithm; why isn&#39;t it used if it&#39;s faster?", "tags": ["java", "performance", "algorithm", "random"], "link": "http://stackoverflow.com/questions/14491966/is-this-a-good-enough-random-algorithm-why-isnt-it-used-if-its-faster/14495128#14495128", "post_type": "answer", "question_id": 14491966, "answer_id": 14495128}, {"body": "<p>There are many, many pseudo random number generators out there. For example Knuth's <a href=\"http://www-cs-faculty.stanford.edu/~uno/programs.html\">ranarray</a>, the <a href=\"http://saluc.engr.uconn.edu/refs/crypto/rng/matsumoto98mersenne.pdf\">Mersenne twister</a>, or look for LFSR generators. Knuth's monumental \"Seminumerical algorithms\" analizes the area, and proposes some linear congruential generators (simple to implement, fast). </p>\n\n<p>But I'd suggest you just stick to <code>java.util.Random</code> or <code>Math.random</code>, they fast and at least OK for occasional use (i.e., games and such). If you are just paranoid on the distribution (some Monte Carlo program, or a genetic algorithm), check out their implementation (source is available somewhere), and seed them with some truly random number, either from your operating system or from <a href=\"http://random.org\">random.org</a>. If this is required for some application where security is critical, you'll have to dig yourself. And as in that case you shouldn't believe what some colored square with missing bits spouts here, I'll shut up now.</p>\n", "title": "Is this a &quot;good enough&quot; random algorithm; why isn&#39;t it used if it&#39;s faster?", "tags": ["java", "performance", "algorithm", "random"], "link": "http://stackoverflow.com/questions/14491966/is-this-a-good-enough-random-algorithm-why-isnt-it-used-if-its-faster/14502259#14502259", "post_type": "answer", "question_id": 14491966, "answer_id": 14502259}, {"body": "<p>java.util.Random is not much different, a basic LCG described by Knuth. However it has main 2 main advantages/differences:</p>\n\n<ul>\n<li>thread safe - each update is a CAS which is more expensive than a simple write and needs a branch (even if perfectly predicted single threaded). Depending on the CPU it could be significant difference.</li>\n<li>undisclosed internal state - this is very important for anything non-trivial. You wish the random numbers not to be predictable.</li>\n</ul>\n\n<p>Below it's the main routine generating 'random' integers in java.util.Random.</p>\n\n<pre><code>\n  protected int next(int bits) {\n        long oldseed, nextseed;\n        AtomicLong seed = this.seed;\n        do {\n          oldseed = seed.get();\n          nextseed = (oldseed * multiplier + addend) & mask;\n        } while (!seed.compareAndSet(oldseed, nextseed));\n        return (int)(nextseed >>> (48 - bits));\n    }\n\n</code></pre>\n\n<p>If you remove the AtomicLong and the undisclosed sate (i.e. using all bits of the <code>long</code>), you'd get more performance than the double multiplication/modulo. </p>\n\n<p>Last note: <code>Math.random</code> should not be used for anything but simple tests, it's prone to contention and if you have even a couple of threads calling it concurrently the performance degrades. One little known historical feature of it is the introduction of CAS in java - to beat an infamous benchmark (first by IBM via intrinsics and then Sun made \"CAS from Java\") </p>\n", "title": "Is this a &quot;good enough&quot; random algorithm; why isn&#39;t it used if it&#39;s faster?", "tags": ["java", "performance", "algorithm", "random"], "link": "http://stackoverflow.com/questions/14491966/is-this-a-good-enough-random-algorithm-why-isnt-it-used-if-its-faster/14513598#14513598", "post_type": "answer", "question_id": 14491966, "answer_id": 14513598}, {"body": "<p>The real problem with this is that it's output histogram is dependent on the initial seed far to much - much of the time it will end up with a near uniform output but a lot of the time will have distinctly un-uniform output.</p>\n\n<p>Inspired by <a href=\"http://boallen.com/random-numbers.html\">this article about how bad php's <code>rand()</code> function is</a>, I made some random matrix images using <code>QuickRandom</code> and <code>System.Random</code>. This run shows how sometimes the seed can have a bad effect (in this case favouring lower numbers) where as <code>System.Random</code> is pretty uniform.</p>\n\n<h1><code>QuickRandom</code></h1>\n\n<p><img src=\"http://i.stack.imgur.com/6LaLK.png\" alt=\"\"></p>\n\n<h1><code>System.Random</code></h1>\n\n<p><img src=\"http://i.stack.imgur.com/CBwTp.png\" alt=\"\"></p>\n\n<h1>Even Worse</h1>\n\n<p>If we initialise <code>QuickRandom</code> as <code>new QuickRandom(0.01, 1.03)</code> we get this image:</p>\n\n<p><img src=\"http://i.imgur.com/Q1Yunbe.png\" alt=\"\"></p>\n\n<h1>The Code</h1>\n\n<pre><code>using System;\nusing System.Drawing;\nusing System.Drawing.Imaging;\n\nnamespace QuickRandomTest\n{\n    public class QuickRandom\n    {\n        private double prevNum;\n        private readonly double magicNumber;\n\n        private static readonly Random rand = new Random();\n\n        public QuickRandom(double seed1, double seed2)\n        {\n            if (seed1 &gt;= 1 || seed1 &lt; 0) throw new ArgumentException(\"Seed 1 must be &gt;= 0 and &lt; 1, not \" + seed1);\n            prevNum = seed1;\n            if (seed2 &lt;= 1 || seed2 &gt; 10) throw new ArgumentException(\"Seed 2 must be &gt; 1 and &lt;= 10, not \" + seed2);\n            magicNumber = seed2;\n        }\n\n        public QuickRandom()\n            : this(rand.NextDouble(), rand.NextDouble() * 10)\n        {\n        }\n\n        public double Random()\n        {\n            return prevNum = (prevNum * magicNumber) % 1;\n        }\n    }\n\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            var rand = new Random();\n            var qrand = new QuickRandom();\n            int w = 600;\n            int h = 600;\n            CreateMatrix(w, h, rand.NextDouble).Save(\"System.Random.png\", ImageFormat.Png);\n            CreateMatrix(w, h, qrand.Random).Save(\"QuickRandom.png\", ImageFormat.Png);\n        }\n\n        private static Image CreateMatrix(int width, int height, Func&lt;double&gt; f)\n        {\n            var bitmap = new Bitmap(width, height);\n            for (int y = 0; y &lt; height; y++) {\n                for (int x = 0; x &lt; width; x++) {\n                    var c = (int) (f()*255);\n                    bitmap.SetPixel(x, y, Color.FromArgb(c,c,c));\n                }\n            }\n\n            return bitmap;\n        }\n    }\n}\n</code></pre>\n", "title": "Is this a &quot;good enough&quot; random algorithm; why isn&#39;t it used if it&#39;s faster?", "tags": ["java", "performance", "algorithm", "random"], "link": "http://stackoverflow.com/questions/14491966/is-this-a-good-enough-random-algorithm-why-isnt-it-used-if-its-faster/14526729#14526729", "post_type": "answer", "question_id": 14491966, "answer_id": 14526729}, {"body": "<p>It is very unlikely that random number generation performance would be an issue for any use-case you came up with unless accessing a single <code>Random</code> instance from multiple threads (because <code>Random</code> is <code>synchronized</code>).</p>\n\n<p>However, if that <em>really</em> is the case and you need lots of random numbers fast, your solution is far too unreliable. Sometimes it gives good results, sometimes it gives <em>horrible</em> results (based on the initial settings).</p>\n\n<p>If you want the same numbers that the <a href=\"http://docs.oracle.com/javase/7/docs/api/java/util/Random.html\" rel=\"nofollow\"><code>Random</code></a> class gives you, only faster, you could get rid of the synchronization in there:</p>\n\n<pre><code>public class QuickRandom {\n\n    private long seed;\n\n    private static final long MULTIPLIER = 0x5DEECE66DL;\n    private static final long ADDEND = 0xBL;\n    private static final long MASK = (1L &lt;&lt; 48) - 1;\n\n    public QuickRandom() {\n        this((8682522807148012L * 181783497276652981L) ^ System.nanoTime());\n    }\n\n    public QuickRandom(long seed) {\n        this.seed = (seed ^ MULTIPLIER) &amp; MASK;\n    }\n\n    public double nextDouble() {\n        return (((long)(next(26)) &lt;&lt; 27) + next(27)) / (double)(1L &lt;&lt; 53);\n    }\n\n    private int next(int bits) {\n        seed = (seed * MULTIPLIER + ADDEND) &amp; MASK;\n        return (int)(seed &gt;&gt;&gt; (48 - bits));\n    }\n\n}\n</code></pre>\n\n<p>I simply took the <a href=\"http://hg.openjdk.java.net/jdk7u/jdk7u-gate/jdk/file/791e94e7b64f/src/share/classes/java/util/Random.java\" rel=\"nofollow\"><code>java.util.Random</code></a> code and removed the synchronization which results in <em>twice</em> the performance compared to the original on my Oracle HotSpot JVM 7u9. It is still slower than your <code>QuickRandom</code>, but it gives much more consistent results. To be precise, for the same <code>seed</code> values and single threaded applications, it gives <em>the same</em> pseudo-random numbers as the original <code>Random</code> class would.</p>\n\n<hr>\n\n<p><sub>This code is based on the current <a href=\"http://hg.openjdk.java.net/jdk7u/jdk7u-gate/jdk/file/791e94e7b64f/src/share/classes/java/util/Random.java\" rel=\"nofollow\"><code>java.util.Random</code> in OpenJDK 7u</a> which is licensed under <a href=\"http://www.gnu.org/licenses/gpl-2.0.html\" rel=\"nofollow\">GNU GPL v2</a>.</sub></p>\n\n<hr>\n\n<p><strong>EDIT</strong> 10 months later:</p>\n\n<p>I just discovered that you don't even have to use my code above to get an unsynchronized <code>Random</code> instance. There's one in the JDK, too!</p>\n\n<p>Look at Java 7's <a href=\"http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ThreadLocalRandom.html\" rel=\"nofollow\"><code>ThreadLocalRandom</code></a> class. The code inside it is almost identical to my code above. The class is simply a local-thread-isolated <code>Random</code> version suitable for generating random numbers quickly. The only downside I can think of is that you can't set its <code>seed</code> manually.</p>\n\n<p>Example usage:</p>\n\n<pre><code>Random random = ThreadLocalRandom.current();\n</code></pre>\n", "title": "Is this a &quot;good enough&quot; random algorithm; why isn&#39;t it used if it&#39;s faster?", "tags": ["java", "performance", "algorithm", "random"], "link": "http://stackoverflow.com/questions/14491966/is-this-a-good-enough-random-algorithm-why-isnt-it-used-if-its-faster/14563808#14563808", "post_type": "answer", "question_id": 14491966, "answer_id": 14563808}, {"body": "<p>The <code>Collections.unmodifiableList</code> has already been mentioned - the <code>Arrays.asList()</code> strangely not! My solution would also be to use the list from the outside and wrap the array as follows:</p>\n\n<pre><code>String[] arr = new String[]{\"1\", \"2\"}; \npublic List&lt;String&gt; getList() {\n    Collections.unmodifiableList(Arrays.asList(arr));\n}\n</code></pre>\n\n<p>The problem with copying the array is: if you're doing it every time you access the code and the array is big, you'll create a lot of work for the garbage collector for sure. So the copy is a simple but really bad approach - I'd say \"cheap\", but memory-expensive! Especially when you're having more than just 2 elements.</p>\n\n<p>If you look at the source code of <code>Arrays.asList</code> and <code>Collections.unmodifiableList</code> there is actually not much created. The first just wraps the array without copying it, the second just wraps the list, making changes to it unavailable.</p>\n", "title": "How do I prevent the modification of a private field in a class?", "tags": ["java", "arrays", "oop", "class"], "link": "http://stackoverflow.com/questions/14809293/how-do-i-prevent-the-modification-of-a-private-field-in-a-class/14821488#14821488", "post_type": "answer", "question_id": 14809293, "answer_id": 14821488}, {"body": "<p>You must use</p>\n\n<pre><code>doThrow(new Exception()).when(mockedObject).methodReturningVoid(...);\n</code></pre>\n\n<p>and not</p>\n\n<pre><code>doThrow(new Exception()).when(mockedObject.methodReturningVoid(...));\n</code></pre>\n\n<p>This is explained in <a href=\"http://site.mockito.org/mockito/docs/current/org/mockito/Mockito.html#5\">the documentation</a></p>\n", "title": "Mockito test a void method throws an exception", "tags": ["java", "exception", "mocking", "mockito"], "link": "http://stackoverflow.com/questions/15156857/mockito-test-a-void-method-throws-an-exception/15157021#15157021", "post_type": "answer", "question_id": 15156857, "answer_id": 15157021}, {"body": "<p>change your return type to <code>ResponseEntity&lt;String&gt;</code>, then you can use below for 400</p>\n\n<pre><code>return new ResponseEntity&lt;String&gt;(HttpStatus.BAD_REQUEST);\n</code></pre>\n\n<p>and for correct request</p>\n\n<pre><code>return new ResponseEntity&lt;String&gt;(json,HttpStatus.OK);\n</code></pre>\n\n<p><strong>UPDATE 1</strong></p>\n\n<p>after spring 4.1 there are helper methods in ResponseEntity could be used as</p>\n\n<pre><code>return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(null);\n</code></pre>\n\n<p>and</p>\n\n<pre><code>return ResponseEntity.ok(json);\n</code></pre>\n", "title": "How to respond with HTTP 400 error in a Spring MVC @ResponseBody method returning String?", "tags": ["java", "spring", "spring-mvc", "http-error"], "link": "http://stackoverflow.com/questions/16232833/how-to-respond-with-http-400-error-in-a-spring-mvc-responsebody-method-returnin/16250729#16250729", "post_type": "answer", "question_id": 16232833, "answer_id": 16250729}, {"body": "<p>You need to escape the dot if you want to split on a <em>literal</em> dot:</p>\n\n<pre><code>String extensionRemoved = filename.split(\"\\\\.\")[0];\n</code></pre>\n\n<p>Otherwise you are splitting on the regex <code>.</code>, which means \"any character\".<br>\nNote the double backslash needed to create a single backslash in the regex.</p>\n\n<hr>\n\n<p>You're getting an <code>ArrayIndexOutOfBoundsException</code> because your input string is just a dot, ie <code>\".\"</code>, which is an edge case that produces an empty array when split on dot; <a href=\"https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#split-java.lang.String-\"><code>split(regex)</code></a> removes all trailing blanks from the result, but since splitting a dot on a dot leaves only two blanks, after trailing blanks are removed you're left with an empty array.</p>\n\n<p>To avoid getting an <code>ArrayIndexOutOfBoundsException</code> for this edge case, use the overloaded version of <a href=\"https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#split-java.lang.String-int-\"><code>split(regex, limit)</code></a>, which has a second parameter that is the size limit for the resulting array. When <code>limit</code> is <em>negative</em>, the behaviour of removing trailing blanks from the resulting array is disabled:</p>\n\n<pre><code>\".\".split(\"\\\\.\", -1) // returns an array of two blanks, ie [\"\", \"\"]\n</code></pre>\n\n<p>ie, when <code>filename</code> is just a dot <code>\".\"</code>, calling <code>filename.split(\"\\\\.\", -1)[0]</code> will return a blank, but calling <code>filename.split(\"\\\\.\")[0]</code> will throw an <code>ArrayIndexOutOfBoundsException</code>.</p>\n", "title": "Java string split with &quot;.&quot; (dot)", "tags": ["java", "regex", "string", "split", "indexoutofboundsexception"], "link": "http://stackoverflow.com/questions/14833008/java-string-split-with-dot/14833048#14833048", "post_type": "answer", "question_id": 14833008, "answer_id": 14833048}, {"body": "<p>\".\" is a special character in java. You have to use \"\\.\" to escape this character :</p>\n\n<pre><code>final String extensionRemoved = filename.split(\"\\\\.\")[0];\n</code></pre>\n\n<p>I hope this helps</p>\n", "title": "Java string split with &quot;.&quot; (dot)", "tags": ["java", "regex", "string", "split", "indexoutofboundsexception"], "link": "http://stackoverflow.com/questions/14833008/java-string-split-with-dot/14833098#14833098", "post_type": "answer", "question_id": 14833008, "answer_id": 14833098}, {"body": "<p>If you know in advance what the size of the <code>ArrayList</code> is going to be, it is more efficient to specify the initial capacity. If you don't do this, the internal array will have to be repeatedly reallocated as the list grows.</p>\n\n<p>The larger the final list, the more time you save by avoiding the reallocations.</p>\n\n<p>That said, even without pre-allocation, inserting <code>n</code> elements at the back of an <code>ArrayList</code> is guaranteed to take total <code>O(n)</code> time. In other words, appending an element is an amortized constant-time operation. This is achieved by having each reallocation increase the size of the array exponentially, typically by a factor of <code>1.5</code>. With this approach, the total number of operations <a href=\"http://www.wolframalpha.com/input/?i=sum%281.5%2a%2ak%29%20for%20k=1,log%281.5,n%29\">can be shown to be <code>O(n)</code></a>.</p>\n", "title": "Why start an ArrayList with an initial capacity?", "tags": ["java", "data-structures", "arraylist", "capacity"], "link": "http://stackoverflow.com/questions/15430247/why-start-an-arraylist-with-an-initial-capacity/15430259#15430259", "post_type": "answer", "question_id": 15430247, "answer_id": 15430259}, {"body": "<p>This is to avoid possible efforts for reallocation for every single object. </p>\n\n<pre><code>int newCapacity = (oldCapacity * 3)/2 + 1;\n</code></pre>\n\n<p>internally <code>new Object[]</code> is created.<br> JVM needs effort to create  <code>new Object[]</code> when you add element in the arraylist. If you don't have above code(any algo you think) for reallocation then every time when you invoke <code>arraylist.add()</code> then <code>new Object[]</code> has to be created which is pointless and we are loosing time for increasing size by 1 for each and every objects to be added. So it is better to increase size of <code>Object[]</code> with following formula.<br>\n(JSL has used forcasting formula given below for dynamically growing arraylist instead of growing by 1 every time. Because to grow it takes effort by JVM)</p>\n\n<pre><code>int newCapacity = (oldCapacity * 3)/2 + 1;\n</code></pre>\n", "title": "Why start an ArrayList with an initial capacity?", "tags": ["java", "data-structures", "arraylist", "capacity"], "link": "http://stackoverflow.com/questions/15430247/why-start-an-arraylist-with-an-initial-capacity/15432106#15432106", "post_type": "answer", "question_id": 15430247, "answer_id": 15432106}, {"body": "<p>I actually wrote a <a href=\"http://www.growingwiththeweb.com/2013/01/manipulating-size-of-list.html\">blog post</a> on the topic 2 months ago. The article is for C#'s <code>List&lt;T&gt;</code> but Java's <code>ArrayList</code> has a very similar implementation. Since <code>ArrayList</code> is implemented using a dynamic array, it increases in size on demand. So the reason for the capacity constructor is for optimisation purposes.</p>\n\n<p>When one of these resizings operation occurs, the ArrayList copies the contents of the array into a new array that is twice the capacity of the old one. This operation runs in <em>O(n)</em> time.</p>\n\n<h2>Example</h2>\n\n<p>Here is an example of how the <code>ArrayList</code> would increase in size:</p>\n\n<pre><code>10\n16\n25\n38\n58\n... 17 resizes ...\n198578\n297868\n446803\n670205\n1005308\n</code></pre>\n\n<p>So the list starts with a capacity of <code>10</code>, when the 11th item is added it is increase by <code>50% + 1</code> to <code>16</code>. On the 17th item the <code>ArrayList</code> is increased again to <code>25</code> and so on. Now consider the example where we're creating a list where the desired capacity is already known as <code>1000000</code>. Creating the <code>ArrayList</code> without the size constructor will call <code>ArrayList.add</code> <code>1000000</code> times which takes <em>O(1)</em> normally or <em>O(n)</em> on resize.</p>\n\n<blockquote>\n  <p>1000000 + 16 + 25 + ... + 670205 + 1005308 = <strong>4015851 operations</strong></p>\n</blockquote>\n\n<p>Compare this using the constructor and then calling <code>ArrayList.add</code> which is guaranteed to run in <em>O(1)</em>.</p>\n\n<blockquote>\n  <p>1000000 + 1000000 = <strong>2000000 operations</strong></p>\n</blockquote>\n\n<h2>Java vs C#</h2>\n\n<p>Java is as above, starting at <code>10</code> and increasing each resize at <code>50% + 1</code>. C# starts at <code>4</code> and increases much more aggressively, doubling at each resize. The <code>1000000</code> adds example from above for C# uses <code>3097084</code> operations.</p>\n\n<h2>References</h2>\n\n<ul>\n<li><a href=\"http://www.growingwiththeweb.com/2013/01/manipulating-size-of-list.html\">My blog post on C#'s List&lt;T&gt;</a></li>\n<li><a href=\"http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/6-b14/java/util/ArrayList.java\">Java's ArrayList source code</a></li>\n</ul>\n", "title": "Why start an ArrayList with an initial capacity?", "tags": ["java", "data-structures", "arraylist", "capacity"], "link": "http://stackoverflow.com/questions/15430247/why-start-an-arraylist-with-an-initial-capacity/15446006#15446006", "post_type": "answer", "question_id": 15430247, "answer_id": 15446006}, {"body": "<p>ArrayList shrinks or expands dynamically.</p>\n\n<p>This is a effective but costly operation, if you know size of your array will be fixed then its better to mention the size of the array,If you don't, new array will be created at each insertion and reallocation will be done for each element.</p>\n\n<p>this will cost you.</p>\n\n<pre><code>ensureCapacity(int cap) \n</code></pre>\n\n<p>this method help to avoid reallocations and helps increase size of arraylist.</p>\n\n<pre><code>trimToSize()\n</code></pre>\n\n<p>this is reverse used to shrink size</p>\n\n<p><strong>Arraylist has 3 constructors:</strong></p>\n\n<ul>\n<li>ArrayList()   -builds empty ArrayList</li>\n<li>ArrayList(Collection c)  - builds a ArrayList initialized with elements of collection c.</li>\n<li><strong>ArrayList(int capacity)</strong>  -builds an ArrayList with specified initial capacity.</li>\n</ul>\n", "title": "Why start an ArrayList with an initial capacity?", "tags": ["java", "data-structures", "arraylist", "capacity"], "link": "http://stackoverflow.com/questions/15430247/why-start-an-arraylist-with-an-initial-capacity/25757711#25757711", "post_type": "answer", "question_id": 15430247, "answer_id": 25757711}, {"body": "<p>It is, in my personal experience admittedly, very useful in cases where an API requires a collection of parameters, but you have nothing to provide.  For example you may have an API that looks something like this, and does not allow null references:</p>\n\n<pre><code>public ResultSet executeQuery(String query, Map&lt;String, Object&gt; queryParameters);\n</code></pre>\n\n<p>If you have a query that doesn't take any parameters, it's certainly a bit wasteful to create a HashMap, which involves allocating an array, when you could just pass in the 'Empty Map' which is effectively a constant, the way it's implemented in <code>java.util.Collections</code>.</p>\n", "title": "Collections.emptyMap() vs new HashMap()", "tags": ["java", "collections"], "link": "http://stackoverflow.com/questions/14846920/collections-emptymap-vs-new-hashmap/14846943#14846943", "post_type": "answer", "question_id": 14846920, "answer_id": 14846943}, {"body": "<p>From <strong>Effective Java</strong>,  <strong>Item #43</strong> - <code>\"Return empty arrays or collections, not null\"</code> demonstrates returning an empty collection and perhaps even demonstrates using these <code>emptyList()</code>, <code>emptySet()</code>, and <code>emptyMap()</code> methods on the Collections class to get an empty collection that also has the additional benefit of being immutable. From  <strong>Item #15</strong>  <code>\"Minimize Mutability\"</code>.</p>\n\n<p>From <a href=\"http://www.coderanch.com/t/536728/java/java/Collections-emptySet-Collections-emptyList-Collections\">Collections-emptySet-Collections-emptyList-Collections</a>  </p>\n\n<blockquote>\n  <p>Its a type of programming idiom. This is for people that do not want null variables. So before the set gets initialized, they can use the empty set. </p>\n</blockquote>\n\n<p><strong>Note:</strong> Below code is just an example (change it according to your use case):  </p>\n\n<pre><code>private Set myset = Collections.emptySet();\n\nvoid initSet() {\n   myset = new HashSet();\n}\nvoid deleteSet() {\n   myset = Collections.emptySet();\n}\n</code></pre>\n\n<p>These methods offer a couple of advantages:</p>\n\n<ol>\n<li><p>They're more concise because you don't need to explicitly type out the generic type of the collection - it's generally just inferred from the context of the method call.   </p></li>\n<li><p>They're more efficient because they don't bother creating new objects; they just re-use an existing empty and immutable object. This effect is generally very minor, but it's occasionally (well, rarely) important.</p></li>\n</ol>\n", "title": "Collections.emptyMap() vs new HashMap()", "tags": ["java", "collections"], "link": "http://stackoverflow.com/questions/14846920/collections-emptymap-vs-new-hashmap/14846960#14846960", "post_type": "answer", "question_id": 14846920, "answer_id": 14846960}, {"body": "<blockquote>\n  <p>Why would I want an immutable empty collection? What is the point?</p>\n</blockquote>\n\n<p>For the same reason you'd use <a href=\"http://docs.oracle.com/javase/7/docs/api/java/util/Collections.html#unmodifiableMap%28java.util.Map%29\" rel=\"nofollow\"><code>Collections.unmodifiableMap()</code></a> at some point. You want to return a Map instance that throws an exception if the user attempts to modify it. It's just a special case: the empty Map.</p>\n", "title": "Collections.emptyMap() vs new HashMap()", "tags": ["java", "collections"], "link": "http://stackoverflow.com/questions/14846920/collections-emptymap-vs-new-hashmap/14846963#14846963", "post_type": "answer", "question_id": 14846920, "answer_id": 14846963}, {"body": "<p>For one, you can get away with reference sharing. A <code>new HashMap()</code> etc will require an allocated object, and possibly some extra elements to hold the data, but you only need one copy of an immutable empty collection (list, set, map, or any other such). This makes it an obvious choice when a method you're calling needs to accept a Map but does not need to edit it.</p>\n\n<p>I suggest checking out Josh Bloch's <em>Effective Java</em>, which lists some very nice attributes of immutable objects (including thread safety).</p>\n", "title": "Collections.emptyMap() vs new HashMap()", "tags": ["java", "collections"], "link": "http://stackoverflow.com/questions/14846920/collections-emptymap-vs-new-hashmap/14846964#14846964", "post_type": "answer", "question_id": 14846920, "answer_id": 14846964}, {"body": "<p>Most of the time we use a <code>constructor</code> to create a new <code>empty map</code>. But the <code>Collections</code> <code>methods</code> offer a couple of advantages to create an <code>empty map</code> using <code>static</code> <code>method</code> <code>java.util.Collections.emptyMap()</code></p>\n\n<blockquote>\n  <ol>\n  <li><p>They're more concise because you don't need to explicitly type out the generic type of the collection - it's generally just inferred from\n  the context of the method call.</p></li>\n  <li><p>They're more efficient because they don't bother creating new objects; they just re-use an existing empty and immutable object. This\n  effect is generally very minor, but it's occasionally (well, rarely)\n  important.</p></li>\n  </ol>\n</blockquote>\n", "title": "Collections.emptyMap() vs new HashMap()", "tags": ["java", "collections"], "link": "http://stackoverflow.com/questions/14846920/collections-emptymap-vs-new-hashmap/14847046#14847046", "post_type": "answer", "question_id": 14846920, "answer_id": 14847046}, {"body": "<p>Use util method of <a href=\"http://docs.oracle.com/javase/7/docs/api/java/util/Collections.html\">java.util.Collections</a> class, i.e</p>\n\n<pre><code>Collections.sort(list)\n</code></pre>\n\n<p>In fact, if you want to sort custom object you can use</p>\n\n<pre><code>Collections.sort(List&lt;T&gt; list, Comparator&lt;? super T&gt; c) \n</code></pre>\n\n<p>see collections api</p>\n", "title": "How to sort a List/ArrayList in Java", "tags": ["java"], "link": "http://stackoverflow.com/questions/16252269/how-to-sort-a-list-arraylist-in-java/16252296#16252296", "post_type": "answer", "question_id": 16252269, "answer_id": 16252296}, {"body": "<p>You can use <code>Collections.sort(list)</code> to sort <code>list</code> if your <code>list</code> contains <code>Comparable</code> elements. Otherwise I would recommend you to implement that interface like here:</p>\n\n<pre><code>public class Circle implements Comparable&lt;Circle&gt; {}\n</code></pre>\n\n<p>and of course provide your own realization of <code>compareTo</code> method like here:</p>\n\n<pre><code>@Override\n    public int compareTo(Circle another) {\n        if (this.getD()&lt;another.getD()){\n            return -1;\n        }else{\n            return 1;\n        }\n    }\n</code></pre>\n\n<p>And then you can again use <code>Colection.sort(list)</code> as now list contains objects of Comparable type and can be sorted. Order depends on <code>compareTo</code> method. Check this <a href=\"https://docs.oracle.com/javase/tutorial/collections/interfaces/order.html\">https://docs.oracle.com/javase/tutorial/collections/interfaces/order.html</a> for more detailed information.</p>\n", "title": "How to sort a List/ArrayList in Java", "tags": ["java"], "link": "http://stackoverflow.com/questions/16252269/how-to-sort-a-list-arraylist-in-java/29652714#29652714", "post_type": "answer", "question_id": 16252269, "answer_id": 29652714}, {"body": "<p><code>Collections.sort</code> allows you to pass an instance of a <code>Comparator</code> which defines the sorting logic. So instead of sorting the list in natural order and then reversing it, one can simply pass <code>Collections.reverseOrder()</code> to <code>sort</code> in order to sort the list in reverse order:</p>\n\n<pre><code>// import java.util.Collections;\nCollections.sort(testList, Collections.reverseOrder());\n</code></pre>\n\n<p>As mentioned by @Marco13, apart from being more idiomatic (and possibly more efficient), using the reverse order comparator makes sure that the sort is stable (meaning that the order of elements will not be changed when they are equal according to the comparator, whereas reversing will change the order)</p>\n", "title": "How to sort a List/ArrayList in Java", "tags": ["java"], "link": "http://stackoverflow.com/questions/16252269/how-to-sort-a-list-arraylist-in-java/30210459#30210459", "post_type": "answer", "question_id": 16252269, "answer_id": 30210459}, {"body": "<p>Escape should be done with <code>\\</code>, not <code>/</code>.</p>\n\n<p>So <code>r.append('\\n');</code> or <code>r.append(\"\\n\");</code> will work (<code>StringBuilder</code> has overloaded methods for <code>char</code> and <code>String</code> type).</p>\n", "title": "How to append a newline to StringBuilder", "tags": ["java", "stringbuilder"], "link": "http://stackoverflow.com/questions/14534767/how-to-append-a-newline-to-stringbuilder/14534791#14534791", "post_type": "answer", "question_id": 14534767, "answer_id": 14534791}, {"body": "<p>It should be </p>\n\n<pre><code>r.append(\"\\n\");\n</code></pre>\n\n<p>But I recommend you to do as below,</p>\n\n<pre><code>r.append(System.getProperty(\"line.separator\"));\n</code></pre>\n\n<p><code>System.getProperty(\"line.separator\")</code> gives you system-dependent newline in java. Also from Java 7 there's a method that returns the value directly: <a href=\"http://docs.oracle.com/javase/7/docs/api/java/lang/System.html#lineSeparator%28%29\"><code>System.lineSeparator()</code></a> </p>\n", "title": "How to append a newline to StringBuilder", "tags": ["java", "stringbuilder"], "link": "http://stackoverflow.com/questions/14534767/how-to-append-a-newline-to-stringbuilder/14534798#14534798", "post_type": "answer", "question_id": 14534767, "answer_id": 14534798}, {"body": "<p>For HTML response  below code can be used </p>\n\n<pre><code>bufString.append(\"&lt;/br&gt;\");\n</code></pre>\n", "title": "How to append a newline to StringBuilder", "tags": ["java", "stringbuilder"], "link": "http://stackoverflow.com/questions/14534767/how-to-append-a-newline-to-stringbuilder/33687544#33687544", "post_type": "answer", "question_id": 14534767, "answer_id": 33687544}, {"body": "<p>Another option is to use Apache Commons StrBuilder, which has the functionality that's lacking in StringBuilder.</p>\n\n<p><a href=\"https://commons.apache.org/proper/commons-lang/javadocs/api-3.1/org/apache/commons/lang3/text/StrBuilder.html#appendln(org.apache.commons.lang3.text.StrBuilder)\">StrBuilder.appendLn()</a></p>\n", "title": "How to append a newline to StringBuilder", "tags": ["java", "stringbuilder"], "link": "http://stackoverflow.com/questions/14534767/how-to-append-a-newline-to-stringbuilder/34073047#34073047", "post_type": "answer", "question_id": 14534767, "answer_id": 34073047}, {"body": "<p>From <a href=\"http://docs.oracle.com/javase/6/docs/api/java/lang/String.html#split%28java.lang.String%29\" rel=\"nofollow\"><strong>String.split() API Doc</strong></a>:</p>\n\n<blockquote>\n  <p>Splits this string around matches of the given regular expression.\n  This method works as if by invoking the two-argument split method with\n  the given expression and a limit argument of zero. Trailing empty\n  strings are therefore not included in the resulting array.</p>\n</blockquote>\n\n<p>Overloaded <a href=\"http://docs.oracle.com/javase/6/docs/api/java/lang/String.html#split%28java.lang.String,%20int%29\" rel=\"nofollow\"><strong>String.split(regex, int)</strong></a> is more appropriate for your case.</p>\n", "title": "Java String split removed empty values", "tags": ["java", "string", "split"], "link": "http://stackoverflow.com/questions/14602062/java-string-split-removed-empty-values/14602092#14602092", "post_type": "answer", "question_id": 14602062, "answer_id": 14602092}, {"body": "<p>From the documentation of <a href=\"http://docs.oracle.com/javase/6/docs/api/java/lang/String.html#split%28java.lang.String%29\"><code>String.split(String regex)</code></a>:</p>\n\n<blockquote>\n  <p>This method works as if by invoking the two-argument split method with the given expression and a limit argument of zero. <strong>Trailing empty strings are therefore not included in the resulting array.</strong> </p>\n</blockquote>\n\n<p>So you will have to use the two argument version <a href=\"http://docs.oracle.com/javase/6/docs/api/java/lang/String.html#split%28java.lang.String,%20int%29\"><code>String.split(String regex, int limit)</code></a> with a negative value:</p>\n\n<pre><code>String[] split = data.split(\"\\\\|\",-1);\n</code></pre>\n\n<p>Doc:</p>\n\n<blockquote>\n  <p>If the limit n is greater than zero then the pattern will be applied at most n - 1 times, the array's length will be no greater than n, and the array's last entry will contain all input beyond the last matched delimiter. <strong>If n is non-positive then the pattern will be applied as many times as possible and the array can have any length. If n is zero then the pattern will be applied as many times as possible, the array can have any length, and trailing empty strings will be discarded.</strong></p>\n</blockquote>\n\n<p>This will not leave out any empty elements, including the trailing ones.</p>\n", "title": "Java String split removed empty values", "tags": ["java", "string", "split"], "link": "http://stackoverflow.com/questions/14602062/java-string-split-removed-empty-values/14602155#14602155", "post_type": "answer", "question_id": 14602062, "answer_id": 14602155}, {"body": "<p>It got deprecated in version <code>4.3-alpha1</code> which you use because of the <code>LATEST</code> version specification. If you take a look at the javadoc of the class, it tells you what to use instead: <code>HttpClientBuilder</code>.</p>\n\n<p>In the latest stable version (<code>4.2.3</code>) the <code>DefaultHttpClient</code> is not deprecated yet.</p>\n", "title": "Deprecated Java HttpClient - How hard can it be?", "tags": ["java", "migration", "apache-httpclient-4.x", "apache-commons-httpclient"], "link": "http://stackoverflow.com/questions/15336477/deprecated-java-httpclient-how-hard-can-it-be/15336606#15336606", "post_type": "answer", "question_id": 15336477, "answer_id": 15336606}, {"body": "<p><strong>Examples from Apache</strong> (<a href=\"https://hc.apache.org/httpcomponents-client-4.5.x/examples.html\" rel=\"nofollow\">link</a>) use this:</p>\n\n<pre><code>HttpClient httpclient = HttpClients.createDefault();\n</code></pre>\n\n<p>The class <code>org.apache.http.impl.client.HttpClients</code> is there since version 4.3. The code for <code>HttpClients.createDefault()</code> is the same as the accepted answer in here.</p>\n", "title": "Deprecated Java HttpClient - How hard can it be?", "tags": ["java", "migration", "apache-httpclient-4.x", "apache-commons-httpclient"], "link": "http://stackoverflow.com/questions/15336477/deprecated-java-httpclient-how-hard-can-it-be/32364785#32364785", "post_type": "answer", "question_id": 15336477, "answer_id": 32364785}, {"body": "<p>You could use <code>printf()</code> with <code>%f</code>:</p>\n\n<pre><code>double dexp = 12345678;\nSystem.out.printf(\"dexp: %f\\n\", dexp);\n</code></pre>\n\n<p>This will print <code>dexp: 12345678.000000</code>. If you don't want the fractional part, use</p>\n\n<pre><code>System.out.printf(\"dexp: %.0f\\n\", dexp);\n</code></pre>\n\n<p>This uses the format specifier language explained in the <a href=\"http://docs.oracle.com/javase/7/docs/api/java/util/Formatter.html#syntax\">documentation</a>.</p>\n\n<p>The default <code>toString()</code> format used in your original code is spelled out <a href=\"http://docs.oracle.com/javase/7/docs/api/java/lang/Double.html#toString%28double%29\">here</a>.</p>\n", "title": "How to print double value without scientific notation using Java?", "tags": ["java", "double"], "link": "http://stackoverflow.com/questions/16098046/how-to-print-double-value-without-scientific-notation-using-java/16098086#16098086", "post_type": "answer", "question_id": 16098046, "answer_id": 16098086}, {"body": "<p><strong>In short:</strong></p>\n\n<p>If you want to get rid of trailing zeros and Locale problems, then you should use :</p>\n\n<pre><code>double myValue = 0.00000021d;\n\nDecimalFormat df = new DecimalFormat(\"0\", DecimalFormatSymbols.getInstance(Locale.ENGLISH));\ndf.setMaximumFractionDigits(340); //340 = DecimalFormat.DOUBLE_FRACTION_DIGITS\n\nSystem.out.println(df.format(myValue)); //output: 0.00000021\n</code></pre>\n\n<p><strong>Explanation:</strong></p>\n\n<p>Why other answers did not suit me :</p>\n\n<ul>\n<li><code>Double.toString()</code> or <code>System.out.println</code> or <code>FloatingDecimal.toJavaFormatString</code> uses scientific notations if double is less than 10^-3 or greater than or equal to 10^7</li>\n<li><p>by using <code>%f</code>, the default decimal precision is 6, otherwise you can hardcode it but it results in extra zeros added if you have less decimals. Example :</p>\n\n<pre><code>double myValue = 0.00000021d;\nString.format(\"%.12f\", myvalue); //output: 0.000000210000\n</code></pre></li>\n<li><p>by using <code>setMaximumFractionDigits(0);</code> or <code>%.0f</code> you remove any decimal precision, which is fine for integers/longs but not for double</p>\n\n<pre><code>double myValue = 0.00000021d;\nSystem.out.println(String.format(\"%.0f\", myvalue)); //output: 0\nDecimalFormat df = new DecimalFormat(\"0\");\nSystem.out.println(df.format(myValue)); //output: 0\n</code></pre></li>\n<li><p>by using DecimalFormat, you are local dependent. In French locale, the decimal separator is a comma, not a point :</p>\n\n<pre><code>double myValue = 0.00000021d;\nDecimalFormat df = new DecimalFormat(\"0\");\ndf.setMaximumFractionDigits(340);\nSystem.out.println(df.format(myvalue));//output: 0,00000021\n</code></pre>\n\n<p>Using the ENGLISH locale makes sure you get a point for decimal separator, wherever your program will run</p></li>\n</ul>\n\n<p>Why using 340 then for <code>setMaximumFractionDigits</code> ?</p>\n\n<p>Two reasons :</p>\n\n<ul>\n<li><code>setMaximumFractionDigits</code> accepts an integer but its implementation has a maximum digits allowed of <code>DecimalFormat.DOUBLE_FRACTION_DIGITS</code> which equals 340</li>\n<li><code>Double.MIN_VALUE = 4.9E-324</code> so with 340 digits you are sure not to round your double and loose precision</li>\n</ul>\n", "title": "How to print double value without scientific notation using Java?", "tags": ["java", "double"], "link": "http://stackoverflow.com/questions/16098046/how-to-print-double-value-without-scientific-notation-using-java/25307973#25307973", "post_type": "answer", "question_id": 16098046, "answer_id": 25307973}, {"body": "<p>just use <strong><a href=\"http://docs.oracle.com/javase/6/docs/api/java/io/File.html#getName%28%29\">File.getName()</a></strong></p>\n\n<pre><code>File f = new File(\"C:\\\\Hello\\\\AnotherFolder\\\\The File Name.PDF\");\nSystem.out.println(f.getName());\n</code></pre>\n\n<p>using <strong>String methods</strong>:</p>\n\n<pre><code>  File f = new File(\"C:\\\\Hello\\\\AnotherFolder\\\\The File Name.PDF\");  \nSystem.out.println(f.getAbsolutePath().substring(f.getAbsolutePath().lastIndexOf(\"\\\\\")+1));\n</code></pre>\n", "title": "How do I get the file name from a String containing the Absolute file path?", "tags": ["java", "file", "filenames", "filepath"], "link": "http://stackoverflow.com/questions/14526260/how-do-i-get-the-file-name-from-a-string-containing-the-absolute-file-path/14526289#14526289", "post_type": "answer", "question_id": 14526260, "answer_id": 14526289}, {"body": "<p>For those looking for a general strategy for reading and writing a string to file:</p>\n\n<p><strong>First, get a file object</strong></p>\n\n<p>You'll need the storage path. For the internal storage, use:</p>\n\n<pre><code>File path = context.getFilesDir();\n</code></pre>\n\n<p>For the external storage (SD card), use:</p>\n\n<pre><code>File path = context.getExternalFilesDir(null);\n</code></pre>\n\n<p>Then create your file object:</p>\n\n<pre><code>File file = new File(path, \"my-file-name.txt\");\n</code></pre>\n\n<p><strong>Write a string to the file</strong></p>\n\n<pre><code>FileOutputStream stream = new FileOutputStream(file);\ntry {\n    stream.write(\"text-to-write\".getBytes());\n} finally {\n    stream.close();\n}\n</code></pre>\n\n<p>Or with Google Guava</p>\n\n<pre><code>Files.write(\"text-to-write\", file, \"UTF-8\");\n</code></pre>\n\n<p><strong>Read the file to a string</strong></p>\n\n<pre><code>int length = (int) file.length();\n\nbyte[] bytes = new byte[length];\n\nFileInputStream in = new FileInputStream(file);\ntry {\n    in.read(bytes);\n} finally {\n    in.close();\n}\n\nString contents = new String(bytes);   \n</code></pre>\n\n<p>Or if you are using Google Guava</p>\n\n<pre><code>String contents = Files.toString(file,\"UTF-8\");\n</code></pre>\n\n<p>For completeness I'll mention </p>\n\n<pre><code>String contents = new Scanner(file).useDelimiter(\"\\\\A\").next();\n</code></pre>\n\n<p>which requires no libraries, but benchmarks 50% - 400% slower than the other options (in various tests on my Nexus 5).</p>\n\n<p><strong>Notes</strong></p>\n\n<p>For each of these strategies, you'll be asked to catch an IOException.  </p>\n\n<p>The default character encoding on Android is UTF-8.  </p>\n\n<p>If you are using external storage, you'll need to add to your manifest either:</p>\n\n<pre><code>&lt;uses-permission android:name=\"android.permission.READ_EXTERNAL_STORAGE\"/&gt;\n</code></pre>\n\n<p>or</p>\n\n<pre><code>&lt;uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\"/&gt;\n</code></pre>\n\n<p>Write permission implies read permission, so you don't need both.</p>\n", "title": "How To Read/Write String From A File In Android", "tags": ["java", "android", "string", "file-io"], "link": "http://stackoverflow.com/questions/14376807/how-to-read-write-string-from-a-file-in-android/22092971#22092971", "post_type": "answer", "question_id": 14376807, "answer_id": 22092971}, {"body": "<p><strong>Note: everything in this post is in the source of Java7-b147</strong></p>\n\n<p><code>Double.parseDouble()</code> goes into a Sun library (in <a href=\"http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7-b147/sun/misc/FloatingDecimal.java#FloatingDecimal.readJavaFormatString%28java.lang.String%29\"><code>sun.misc.FloatingDecimal</code></a>) the first important thing that happens is:</p>\n\n<pre><code>in = in.trim(); // don't fool around with white space.\n                // throws NullPointerException if null\n</code></pre>\n\n<p><code>Integer.parseInt()</code> is done manually in the <a href=\"http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7-b147/java/lang/Integer.java#Integer.parseInt%28java.lang.String%2Cint%29\"><code>Integer</code></a> class. The first important thing that happens is:</p>\n\n<pre><code>if (s == null) {\n    throw new NumberFormatException(\"null\");\n}\n</code></pre>\n\n<p>I would guess there are two different authors.</p>\n", "title": "Why do Double.parseDouble(null) and Integer.parseInt(null) throw different exceptions?", "tags": ["java", "exception", "nullpointerexception", "numberformatexception"], "link": "http://stackoverflow.com/questions/16324831/why-do-double-parsedoublenull-and-integer-parseintnull-throw-different-excep/16324963#16324963", "post_type": "answer", "question_id": 16324831, "answer_id": 16324963}, {"body": "<p>A very simple implementation with <a href=\"http://docs.oracle.com/javase/6/docs/api/java/lang/String.html#split%28java.lang.String%29\"><code>String.split()</code></a>:</p>\n\n<pre><code>String path = \"/abc/def/ghfj.doc\";\n// Split path into segments\nString segments[] = path.split(\"/\");\n// Grab the last segment\nString document = segments[segments.length - 1];\n</code></pre>\n", "title": "Java: Getting a substring from a string starting after a particular character", "tags": ["java", "string", "substring"], "link": "http://stackoverflow.com/questions/14316487/java-getting-a-substring-from-a-string-starting-after-a-particular-character/14316543#14316543", "post_type": "answer", "question_id": 14316487, "answer_id": 14316543}, {"body": "<p>Use <code>Integer</code> instead.</p>\n\n<pre><code>HashMap&lt;Integer, MyObject&gt; myMap = new HashMap&lt;Integer, MyObject&gt;();\n</code></pre>\n\n<p>Java will automatically autobox your <code>int</code> primitive values to <code>Integer</code> objects.</p>\n\n<p>Read more about <a href=\"http://docs.oracle.com/javase/7/docs/technotes/guides/language/autoboxing.html\">autoboxing</a> from Oracle Java documentations.</p>\n", "title": "HashMap and int as key", "tags": ["java", "hashmap"], "link": "http://stackoverflow.com/questions/16148575/hashmap-and-int-as-key/16148593#16148593", "post_type": "answer", "question_id": 16148575, "answer_id": 16148593}, {"body": "<p>use int as Object not as primitive type</p>\n\n<pre><code>HashMap&lt;Integer, myObject&gt; myMap = new HashMap&lt;Integer, myObject&gt;();\n</code></pre>\n", "title": "HashMap and int as key", "tags": ["java", "hashmap"], "link": "http://stackoverflow.com/questions/16148575/hashmap-and-int-as-key/16148619#16148619", "post_type": "answer", "question_id": 16148575, "answer_id": 16148619}, {"body": "<p>Please use \n<code>HashMap&lt;Integer, myObject&gt; myMap = new HashMap&lt;Integer, myObject&gt;();</code></p>\n", "title": "HashMap and int as key", "tags": ["java", "hashmap"], "link": "http://stackoverflow.com/questions/16148575/hashmap-and-int-as-key/16148647#16148647", "post_type": "answer", "question_id": 16148575, "answer_id": 16148647}, {"body": "<p>You can't use a primitive because HashMap use object internally for the key. So you can only use an object that inherits from Object (that is any object).</p>\n\n<p>That is the function put() in HashMap and as you can see it uses Object for K:</p>\n\n<pre><code>public V put(K key, V value) {\n    if (key == null)\n        return putForNullKey(value);\n    int hash = hash(key);\n    int i = indexFor(hash, table.length);\n    for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) {\n        Object k;\n        if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) {\n            V oldValue = e.value;\n            e.value = value;\n            e.recordAccess(this);\n            return oldValue;\n        }\n    }\n\n    modCount++;\n    addEntry(hash, key, value, i);\n    return null;\n}\n</code></pre>\n\n<p>The expression \"k = e.key\" should make it clear.</p>\n\n<p>I suggest to use a wrapper like Integer and autoboxing.</p>\n", "title": "HashMap and int as key", "tags": ["java", "hashmap"], "link": "http://stackoverflow.com/questions/16148575/hashmap-and-int-as-key/16149127#16149127", "post_type": "answer", "question_id": 16148575, "answer_id": 16149127}, {"body": "<p>HashMap does not allow primitive data types as arguments. It can only accept objects so </p>\n\n<pre><code>HashMap&lt;int, myObject&gt; myMap = new HashMap&lt;int, myObject&gt;();\n</code></pre>\n\n<p>will not work.</p>\n\n<p>You have to change the declaration to </p>\n\n<pre><code>HashMap&lt;Integer, myObject&gt; myMap = new HashMap&lt;Integer, myObject&gt;();\n</code></pre>\n\n<p>so even when you do the following</p>\n\n<pre><code>myMap.put(2,myObject);\n</code></pre>\n\n<p>The primitive data type is autoboxed to an Integer object. </p>\n\n<pre><code>8 (int) === boxing ===&gt; 8 (Integer)\n</code></pre>\n\n<p>You can read more on autoboxing here <a href=\"http://docs.oracle.com/javase/tutorial/java/data/autoboxing.html\" rel=\"nofollow\">http://docs.oracle.com/javase/tutorial/java/data/autoboxing.html</a></p>\n", "title": "HashMap and int as key", "tags": ["java", "hashmap"], "link": "http://stackoverflow.com/questions/16148575/hashmap-and-int-as-key/16149160#16149160", "post_type": "answer", "question_id": 16148575, "answer_id": 16149160}, {"body": "<p>If you code in Android, there is <a href=\"http://developer.android.com/reference/android/util/SparseArray.html\" rel=\"nofollow\">SparseArray</a>, mapping integer to object.</p>\n", "title": "HashMap and int as key", "tags": ["java", "hashmap"], "link": "http://stackoverflow.com/questions/16148575/hashmap-and-int-as-key/18481387#18481387", "post_type": "answer", "question_id": 16148575, "answer_id": 18481387}, {"body": "<p>For everybody who codes Java for Android devices and ends up here: use SparseArray for better performance</p>\n\n<pre><code>private final SparseArray&lt;myObject&gt; myMap = new SparseArray&lt;myObject&gt;();\n</code></pre>\n\n<p>with this you can use int instead of Integer like</p>\n\n<pre><code>int newPos = 3;\n\nmyMap.put(newPos, newObject);\nmyMap.get(newPos);\n</code></pre>\n", "title": "HashMap and int as key", "tags": ["java", "hashmap"], "link": "http://stackoverflow.com/questions/16148575/hashmap-and-int-as-key/20454885#20454885", "post_type": "answer", "question_id": 16148575, "answer_id": 20454885}, {"body": "<p>The main reason with <strong><em>HashMap</em></strong> not allowing primitive as keys is that HashMap is designed in such a way that for comparing the keys, it makes use of <strong><em>equals()</em></strong> method, and a method can be called only on an object not on a primitive.</p>\n\n<p>Thus when int is autoboxed to Integer, Hashmap can call <strong><em>equals()</em></strong> method on Integer object.</p>\n\n<p>That is why, you should use Integer instead of int. I mean hashmap throws an error while putting int as a key (Don't know the meaning of the error that is thrown)</p>\n\n<p>And if you think that, you can make Map performance faster by making a primitive as a key, there is a library called <strong><em>FastUtil</em></strong> which contains a Map implementation with int type as a key.</p>\n\n<p>Because of this, it is much faster than <strong><em>Hashmap</em></strong></p>\n", "title": "HashMap and int as key", "tags": ["java", "hashmap"], "link": "http://stackoverflow.com/questions/16148575/hashmap-and-int-as-key/32866218#32866218", "post_type": "answer", "question_id": 16148575, "answer_id": 32866218}]}